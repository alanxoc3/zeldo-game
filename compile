#!/usr/bin/env bash
t1="that story about zeldo"
t2="amorg"

files_in_order="
src/lib.lua
src/att.lua

src/chars.lua
src/outlines.lua
src/draw.lua
src/inventory.lua
src/inventory_selection.lua
src/map.lua
src/menu.lua
src/misc.lua
src/move_funcs.lua
src/squares.lua
src/tbox.lua
src/tcol.lua
src/title.lua
src/view.lua

src/map_data.lua
src/story.lua
src/parents.lua
src/acts/*
src/demo.lua
"

CODE_STORE=build\\/prd-store.p8
WRITER_STORE=prd-store.p8

echo "Cleaning build directory..."
rm -r build
mkdir -p build

echo "Running the lua minifier..."
cat src/dev-boot.lua $files_in_order | ./pico_minifier -d                                            > build/dev-code.lua
cat src/prd-boot.lua $files_in_order | ./pico_minifier -i src/prd-writer.lua -o build/prd-writer.lua > build/prd-code.lua

sed -i "s/STORE_FILEPATH/$CODE_STORE/g" build/prd-code.lua
echo "Writing boot cartridge with pico8..."
pico8 -x build/prd-writer.lua -p $WRITER_STORE
