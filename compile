#!/usr/bin/env bash
t1="that story about zeldo"
t2="amorg"

files_in_order="
src/lib.lua
src/att.lua

src/chars.lua
src/outlines.lua
src/draw.lua
src/inventory.lua
src/inventory_selection.lua
src/map.lua
src/menu.lua
src/misc.lua
src/move_funcs.lua
src/squares.lua
src/tbox.lua
src/tcol.lua
src/title.lua
src/view.lua

src/map_data.lua
src/story.lua
src/parents.lua
src/acts/*
src/demo.lua
"

./pico_minifier -d $files_in_order > ._compiled.lua

perl -0777 -pi -e '
my $doc = do {
    local $/ = undef;
    open my $fh, "<", "._compiled.lua"
        or die "could not open file";
    <$fh>;
}; my $header = "'"-- $t1\n-- $t2"'";
s/(__lua__).*(__gfx__)/$1\n$header\n$doc\n$2/igs;
' zeldo.p8

rm ._compiled.lua
