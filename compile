#!/usr/bin/env bash
t1="that story about zeldo"
t2="amorg"

files_in_order="
src/lib.lua
src/att.lua

src/chars.lua
src/outlines.lua
src/draw.lua
src/inventory.lua
src/inventory_selection.lua
src/map.lua
src/menu.lua
src/misc.lua
src/move_funcs.lua
src/squares.lua
src/tbox.lua
src/tcol.lua
src/title.lua
src/view.lua

src/map_data.lua
src/story.lua
src/parents.lua
src/acts/*
src/demo.lua
"

echo "* Cleaning build directory..."
rm -r build
mkdir -p build

if [ "$1" == "-p" ]; then
   echo "* Running the prd-mode and not debug-mode minifier..."
   cat src/prd-boot.lua $files_in_order | ./pico_minifier -i src/prd-writer.lua -o build/writer.lua > build/code.lua

   # Not in minifier, because it doesn't need to know file paths.
   sed -i "s/STORE_FILEPATH/build\\/store.p8/g" build/code.lua

   echo "* Running prd-mode pico-8 cstore..."
   pico8 -x build/writer.lua -p store.p8
elif [ "$1" == "-d" ]; then
   echo "* Running the dev-mode and not debug-mode minifier..."
   cat src/dev-boot.lua $files_in_order | ./pico_minifier --dev > build/code.lua
else
   echo "* Running the dev-mode and debug-mode minifier..."
   cat src/dev-boot.lua $files_in_order | ./pico_minifier --dev --debug > build/code.lua
fi

echo "* Done!"
