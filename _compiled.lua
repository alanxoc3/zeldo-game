function od(sp)return sp==0 and 0 or sgn(sp)end function lq()return flr(rnd(3))-1 end function hf(pa,fd)for os,aq in pairs(fd or{})do pa[os]=aq end end function ii(le,na,...)if na and na[le]then return na[le](na,...)end end function cx(ah,na)foreach(na,function(t)ah(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])end)end function op(ah,...)cx(ah,ol(...))end function ct(nt,s,sb)local rl,ae,sd,nz,sq,lc={},"",1,true while s<=#nt do local o=sub(nt,s,s)if o=="\""then lc,nz=not lc elseif o=="|" then elseif lc then ae=ae..o elseif o=="}"or o==","then if type(ae)=="na"or not nz then elseif sub(ae,1,1)=="@"then local rc=tonum(sub(ae,2,#ae))assert(rc!=nil)if not sb[rc]then sb[rc]={}end add(sb[rc],{rl,sq or sd})elseif ae=="az"then ae=function()end elseif ae=="true"or ae=="false"then ae=ae=="true" elseif ae=="nil"or ae==""then ae=nil elseif nz then ae=tonum(ae)end rl[sq or sd],nz,ae,sd,sq=ae,true,"",sq and sd or sd+1 if o=="}"then return rl,s end elseif o=="{"then ae,s,nz=ct(nt,s+1,sb)elseif o=="="then nz,sq,ae=true,ae,"" elseif o!=" "and o!="\n"then ae=ae..o end s+=1 end return rl,s,sb end hd={}function ol(nt,...)if not hd[nt]then hd[nt]={ct(nt..",",1,{})}end local rw,lw={...},hd[nt]for os,aq in pairs(lw[3])do foreach(lw[3][os],function(o)o[1][o[2]]=rw[os]end)end return lw[1]end function mt(x,...)if x.oe==0 then x.og=x.hp x.hp=(x.og%#x.nv)+1 x.oe=x.nv[x.og]and x.nv[x.og].ab or nil hf(x,x.nv[x.og])ii("s",x,...)end if ii("k",x,...)then x.oe=0 end if x.oe then x.oe=max(0,x.oe-1/60)end end function gm(x,sp)x.oe=0 if sp then x.hp=sp end end function mc(x,nv)hf(x,ol([[vd=true,nv=@1,vi=0,og=0,hp=1,oe=0]],nv or{}))return x end function dw(...)return mc({},ol(...))end function vh()for s=1,15 do pal(s,gk[s])end end function df(a,ft)(ft or spr)(a.c,oq(a.o-a.oz*.5)+a.iv+a.nc,ok(a.i-a.oc*.5)+a.ow+a.hs,a.oz,a.oc,a.h,a.iu,1)end function hm(a)df(a,nn)end hh={}function yl(c,oz,oc)local de=oc*8-1 local vs,uw={},function(o,i)return mid(0,o,de)==o and sget(o+c*8%128,i+flr(c/16)*8)!=0 end local hw=function(o)local on,oy for s=0,de do on,oy=on or uw(o,s)and s-1,oy or uw(o,de-s)and oc*8-s end return{on=on or oc*8+2,oy=oy or 0}end hh[c]={}for s=0xffff,oz*8 do local cu,d,n=hw(s-1),hw(s),hw(s+1)local on,oy=min(min(cu.on,d.on),n.on),max(max(cu.oy,d.oy),n.oy)if oy>=on then add(hh[c],{ou=s,id=on,oh=s,nj=oy})end end end function nn(c,o,i,oz,oc,h,iu,z)if not oz then oz=1 end if not oc then oc=1 end local ln,la,hg,ds=o,1,i,1 if h then ln,la=oz*8-1+o,0xffff end if iu then hg,ds=oc*8-1+i,0xffff end if not hh[c]then yl(c,oz,oc)end foreach(hh[c],function(as)rectfill(ln+la*as.ou,hg+ds*as.id,ln+la*as.oh,hg+ds*as.nj,z)end)end function md(ib,o,yj)return o-(yj and(#ib*4+1)or 0)end function ng(ib,o,i,px)print(ib,o,i+(px and 1 or-1),1)print(ib,o,i,7)end yi=ol([[{0,0,0,0,0,0,0},{1,1,1,0,0,0,0},{2,2,2,1,0,0,0},{3,3,3,1,0,0,0},{4,2,2,2,1,0,0},{5,5,1,1,1,0,0},{6,13,13,5,5,1,0},{6,6,13,13,5,1,0},{8,8,2,2,2,0,0},{9,4,4,4,5,0,0},{10,9,4,4,5,5,0},{11,3,3,3,3,0,0},{12,12,3,1,1,1,0},{13,5,5,1,1,1,0},{14,13,4,2,2,1,0},{15,13,13,5,5,1,0}]])function dn(s)for d=0,15 do if flr(s+1)>=8 then pal(d,0)else pal(d,yi[d+1][flr(s+1)])end end end io,ak={},{}function ap(...)local rw=ol(...)ak[rw.r]=function(a)return me(rw,a or{})end end function ad(...)return me(ol(...))end function me(rv,a)foreach(rv.v,function(yt)a=ak[yt](a)end)hf(a,rv.b)local r=rv.r if not a[r]then io[r]=io[r]or{}add(io[r],a)end a.r,a[r]=r,true mc(a,rv.x)return a end function su(r,ah,...)for a in all(io[r])do if a[ah]then a[ah](a,...)end end end function pt(a)for os,aq in pairs(io)do if a[os]then del(aq,a)end end end ap([[r="ir",b={an=true,ns=0,s=az,k=az,fs=@1,wb=@2,oj=az,ce=@3}]],function(a)if a.an and a.ns==0 then mt(a)end end,function(a)if not a.an then a:oj()a:ce()end end,function(a)pt(a)end)ap([[r="ac",b={},v={"ir"}]])ap([[r="ik",b={py=@1},v={"ir"}]],function(a)local j=sm[ht]if a.o+a.at<j.o+.5 then a.o=j.o+.5 a.at=0 end if a.o+a.at>j.o+j.l-.5 then a.o=j.o+j.l-.5 a.at=0 end if a.i+a.aa<j.i+.5 then a.i=j.i+.5 a.aa=0 end if a.i+a.aa>j.i+j.w-.5 then a.i=j.i+j.w-.5 a.aa=0 end end)ap([[r="dg",b={t=0,ab=0,mk=@1},v={"ir"}]],function(a)a.t+=1 end)ap([[r="ia",b={o=0,i=0},v={"ir"}]])ap([[r="ni",b={at=0,aa=0,gz=@1},v={"ia"}]],function(a)a.o+=a.at a.i+=a.aa end)ap([[r="oo",b={gw=.85,yr=.85,ai=0,ag=0,pz=@1},v={"ni"}]],function(a)a.at+=a.ai a.aa+=a.ag a.at*=a.gw a.aa*=a.yr if a.ai==0 and abs(a.at)<.01 then a.at=0 end if a.ag==0 and abs(a.aa)<.01 then a.aa=0 end end)ap([[r="sf",b={f=.375,m=.375,wa=@1},v={"ia"}]],function(a)mv(a.o-a.f,a.i-a.m,a.o+a.f,a.i+a.m,8)end)ap([[r="iy",b={of=0,ss=0,oi=0,ba=0,wq=@1},v={"ir"}]],function(a,im)a.o,a.i,a.at,a.aa=im.o+a.of,im.i+a.ss,im.at+a.oi,im.aa+a.ba a.nc,a.hs=im.nc,im.hs end)ap([[r="rm",b={iv=0,ow=0,nc=0,hs=0,y=az,fa=@1},v={"ir"}]],function(a)a.nc,a.hs=0,0 end)ap([[r="spr",b={c=0,oz=1,oc=1,h=false,iu=false,pb=@1},v={"ni","rm"}]],df)ap([[r="al",b={gc=@1},v={"spr"}]],hm)ap([[r="ox",b={nl=@1},v={"oo"}]],function(a,mf,hu,uh)mb(15)if hu!=0 then a.at=hu*mf else a.aa=uh*mf end end)ap([[r="ih",b={sj=@1,yy=@2},v={"oo","rm"}]],function(a,li)if a.ns==0 then a.ns=li end end,function(a)if a.ns!=0 then a.ag,a.ai=0,0 a.nc=lq()a.ns-=1 end end)ap([[r="nw",b={oa=33,se=33,ly=@1},v={"ir"}]],function(a,wi)a.oa=min(a.se,a.oa-wi)if a.oa<=0 then a.an=false end end)ap([[r="ij",b={iz={},fp=1,sl=0,ov=1,hr=0,hv=nil,bo=@1},v={"spr","dg"}]],function(a)if a.hv then a.c=a.hv else if a.t%a.hr==0 then a.sl+=1 a.sl%=a.ov end a.c=a.iz[a.fp+a.sl]or 0xffff end end)ap([[r="ho",b={mr=true,sg=true,ay=true,aj=az},v={"ni","sf"}]])ap([[r="sx",b={cl=az,wm=@1},v={"ni","sf"}]],function(a,u)if u.o-u.f>a.o-a.f and u.o+u.f<a.o+a.f and u.i-u.m>a.i-a.m and u.i+u.m<a.i+a.m then a.cl(a,u)end end)ap([[r="z",b={sg=false,ay=true,um=0,dj=0,aj=az,sy=@1},v={"ni","sf"}]],function(a,wk)local rk={}local sy=function(at,aa)local db=false local gt=function(ix,lu,a,q,ia,aw)if aw!=0 and ia<abs(a[ix]-q[ix])then if a.ay and q.ay then aq=a[lu]+q[lu]local ut=function(d)if not d.sg then d[lu]=aq/2 end end ut(a)ut(q)db=true end rk[q][ix]=aw>0 and 1 or 0+aw<0 and 0xffff or 0 end end foreach(wk,function(q)if a!=q and(not a.sg or not q.sg)then local o,i=abs(a.o+at-q.o),abs(a.i+aa-q.i)if o<(a.f+q.f)and i<(a.m+q.m)then if not rk[q]then rk[q]={o=0,i=0}end op(gt,[[{"o","at",@1,@2,@3,@4},{"i","aa",@1,@2,@5,@6}]],a,q,o,at,i,aa)end end end)if db then at*=-a.um aa*=-a.dj end return at+aa end a.at=sy(a.at,0)a.aa=sy(0,a.aa)for q,y in pairs(rk)do a:aj(q,y.o,y.i)q:aj(a,-y.o,-y.i)end end)ap([[r="nh",b={"ml"=az,"gg"=@1},v={"ni","sf"}]],function(a,sc)a.o,a.at=cy(a.o,a.i,a.at,a.f,a.m,0,a,a.ml,sc)a.i,a.aa=cy(a.i,a.o,a.aa,a.m,a.f,2,a,a.ml,function(i,o)return sc(o,i)end)end)FPS=60 function ha(fv)return flr(t()*FPS)%(fv or 0)end hx={}function wt(fh,fw,fm)hx[fh]={yv=ha()+fw,ah=fm}end function mx()for os,aq in pairs(hx)do if aq.yv-ha()<=0 then ii("ah",aq)del(hx,aq)end end end ll=ol([[{o=02,i=12,is="ck"},{o=52,i=60,is="ru"},{o=69,i=17,is="lp"},{o=123,i=14,is="hc"},{o=123,i=60,is="lb"}]])function gi()sm=ol([["wv"={n="wv",d=03,t=10,o=000,i=00,l=128,w=64},"bw"={n="mp",d=03,t=10,o=000,i=16,l=64,w=16,ao={"rz",063,36}},"iw"={n="mp",d=03,t=17,o=000,i=16,l=32,w=16,ao={"rz",063,38},as={"uz",033,29},{"af",16,18.5,"cm",28,15},{"af",20,24.5,"go",12,15},{"af",12,24.5,"wl",12,07},{"af",06,22.5,"ck",04,15},{"af",26,22.5,"ym",20,15},{"nd",14.5,19.5,"|sign:mayor lank's home"},{"nd",18.5,24.5,"|sign:bob and bobett's home"},{"nd",13.5,24.5,"|sign:hiroll shop"},{"nd",04.5,22.5,"|sign:ole banjo's house"},{"nd",27.5,22.5,"|sign:hiroll tutorial"},{"hb",14,28}},"uz"={n="mp",d=03,t=17,o=032,i=16,l=32,w=16,ao={"iw",031,29},as={"dz",033,02}},"rz"={n="so",d=03,t=10,o=048,i=32,l=16,w=08,as={"iw",001,29},ao={"uu",063,44},k={"ig",040,62},y={"ig",040,54},{"af",60,34.5,"cj",28,15},{"nd",58.5,34.5,"|sign:lark's house"}},"uu"={n="so",d=03,t=10,o=048,i=40,l=16,w=08,as={"rz",049,36},ao={"ig",046,58},k={"ig",040,62},y={"ua",060,49}},"ua"={n="so",d=03,t=10,o=048,i=48,l=16,w=08,as={"ig",034,58},ao={"ru",063,60},k={"uu",060,47},y={"ig",040,54}},"ru"={n="so",d=03,t=10,o=048,i=56,l=16,w=08,as={"ua",049,52},ao={"ig",046,58},k={"uo",040,51},y={"ig",040,54},{"af",56,58.5,"wj",20,07},{"on",56,60}},"uo"={n="so",d=03,t=10,o=032,i=40,l=16,w=12,k={"mq",040,39},y={"ru",052,57}},"mq"={n="so",d=03,t=10,o=032,i=32,l=16,w=08,y={"uo",040,41}},"ig"={n="so",d=03,t=10,o=032,i=52,l=16,w=12},"dz"={n="cf",d=13,t=10,o=032,i=00,l=16,w=08,ao={"uz",063,29},as={"rd",097,29}},"rd"={n="cf",d=13,t=10,o=096,i=00,l=16,w=32,ao={"dz",047,06},as={"dr",033,12},{"af",100,27.5,"ps",04,07}},"dr"={n="cf",d=13,t=10,o=032,i=08,l=16,w=08,ao={"rd",111,29},as={"dy",049,12}},"dy"={n="uk",d=04,t=10,o=048,i=00,l=16,w=16,ao={"dr",047,12},as={"dl",085,30}},"dl"={n="uk",d=04,t=10,o=084,i=12,l=12,w=20,ao={"dy",063,04},k={"dk",088,11}},"dk"={n="uk",d=04,t=10,o=080,i=00,l=16,w=12,y={"dl",090,13},{"af",088,01.5,"ul",69,31,102}},"mj"={n="uc",d=13,t=10,o=112,i=24,l=16,w=08,y={"rd",104,04},k={"hc",120,23}},"hc"={n="uc",d=13,t=10,o=112,i=12,l=16,w=12,y={"mj",120,25},k={"pl",120,11}},"pl"={n="uc",d=13,t=10,o=112,i=00,l=16,w=12,y={"hc",120,13}},"ul"={n="lv",d=13,t=10,o=064,i=22,l=10,w=10,y={"dk",088,02},as={"us",075,27}},"us"={n="lv",d=13,t=10,o=074,i=22,l=10,w=10,ao={"ul",073,27},k={"lp",079,21}},"lp"={n="lv",d=13,t=10,o=064,i=12,l=20,w=10,y={"us",079,23},k={"fo",072,11}},"fo"={n="lv",d=13,t=10,o=064,i=00,l=16,w=12,y={"lp",072,13}},"lb"={n="hj",d=13,t=10,o=112,i=56,l=16,w=08,ao={"yn",111,60},k={"mh",120,55}},"yn"={n="hj",d=13,t=10,o=096,i=44,l=16,w=20,as={"lb",113,60}},"mh"={n="hj",d=13,t=10,o=112,i=44,l=16,w=12,y={"lb",120,57},k={"pp",120,43}},"pp"={n="hj",d=13,t=10,o=112,i=32,l=16,w=12,y={"mh",120,45}},"ps"={n="af",d=04,t=10,o=000,i=00,l=08,w=08,y={"rd",100,28}},"wl"={n="af",d=04,t=10,o=008,i=00,l=08,w=08,y={"iw",012,25}},"wj"={n="af",d=03,t=10,o=016,i=00,l=08,w=08,y={"ru",056,59}},"gr"={n="af",d=04,t=10,o=024,i=00,l=08,w=08,y={"cm",028,09}},"pm"={n="af",d=04,t=10,o=024,i=00,l=08,w=08,y={"cj",028,09},{"nu",25.5,1.5},{"nu",25.5,6.5},{"nu",30.5,1.5},{"nu",30.5,6.5}},"ck"={n="af",d=04,t=10,o=000,i=08,l=08,w=08,y={"iw",006,23}},"go"={n="af",d=04,t=10,o=008,i=08,l=08,w=08,y={"iw",020,25}},"ym"={n="af",d=04,t=10,o=016,i=08,l=08,w=08,y={"iw",026,23}},"cm"={n="af",d=04,t=10,o=024,i=08,l=08,w=08,y={"iw",016,19},k={"gr",028,07}},"cj"={n="af",d=04,t=10,o=024,i=08,l=08,w=08,y={"rz",060,35},k={"pm",028,07},{"nu",26.5,11.5},{"nu",30.5,13.5},{"hb",28,12.5}},"wg"={n="wg",d=03,o=96,i=32,l=11,w=10},"by"={n="bf",d=13,o=96,i=32,l=16,w=12}]])for os,aq in pairs(sm)do aq.s=function()cx(function(pe,...)ak[pe](...)end,aq)end end end uy,mm=0,0 lk=0 function wx(o,i)dn(lk)local j=sm[ht]local rq=min(16,j.l)local rh=min(12,j.w)local f=o-rq/2 local m=i-rh/2 uy=-(16-rq)/2+f mm=-(16-rh)/2+m for os,aq in pairs({5,1,1})do rect(f*8+os,m*8+os,(f+rq)*8-os-1,(m+rh)*8-os-1,aq)end clip(f*8+4,m*8+4,rq*8-8,rh*8-8)rectfill(0,0,127,127,j.d)yh(j.o,j.i,j.o,j.i,j.l,j.w)lj(io["al"])lj(io["spr"])lj(io["rm"])su("al","gc")su("spr","pb")clip()dn(0)end function lj(t)for n=2,#t do local s=n while s>1 and t[s].i<t[s-1].i do t[s],t[s-1]=t[s-1],t[s]s=s-1 end end end function cb(ld,f,m)reload(0x1000,0x1000,0x2000)ht=ld j=sm[ht]su("ac","ce")if j.s then j.s()end local o,i,l,w=j.o,j.i,j.l,j.w au.o=f au.i=m yp(o,i,l,w,5,11,2,2)po(au.o,au.i)end ra=0 sr=0 re=false function lg(ld,f,m,am)if not re then re=true fn=cocreate(function()for s=0,20 do lk=s/20*10 if am=='k' then sr=sin(s/80+.5)*10 elseif am=='y' then sr=sin(s/80)*10 elseif am=='ao' then ra=sin(s/80+.5)*10 elseif am=='as' then ra=sin(s/80)*10 end yield()end cb(ld,f,m)yield()for s=20,0,-1 do lk=s/20*10 if am=='k' then sr=sin(s/80)*10 elseif am=='y' then sr=sin(s/80+.5)*10 elseif am=='ao' then ra=sin(s/80)*10 elseif am=='as' then ra=sin(s/80+.5)*10 end yield()end re=false end)end end function fl()local j=sm[ht]if re then coresume(fn)elseif j then local am=nil if au.i>ro+hk-.375 then am='y' elseif au.i<ro+.5 then am='k' elseif au.o>sk+hy-.375 then am='as' elseif au.o<sk+.5 then am='ao' end if am!=nil and j[am]then lg(j[am][1],j[am][2],j[am][3],am)end end end dv=ol([[{om=0x1040.1040,rs=4,oe=15},{om=0x1284.1284,rs=4,oe=30},{om=0x1248.1248,rs=12,oe=10},{om=0x70e0.b0d0,rs=12,oe=1}]])function fi()foreach(dv,function(o)if ha(o.oe)==0 then o.om=rotl(o.om,o.rs)end end)end function hi(z,om)om=dv[om].om return 0x1000+z+om-flr(om)end function be(o,i,a)camera(-o,-i)op(rectfill,[[{0,0,17,17,5},{1,1,16,16,6},{2,2,15,15,0}]],hi(0x43,4))clip(o+2,i+2,14,14)nn(a.c,5+od(a.ai),5+od(a.ag),1,1,a.h,a.iu,1)if a.u then nn(59,5+od(a.ai),5+od(a.ag),1,1,a.h,a.iu,1)end if a.p then local p=a.p nn(p.c,5+(p.o-a.o)*8+od(a.ai)+p.iv,7+(p.i-a.i)*8+od(a.ag)+p.ow,1,1,p.h,p.iu,1)end spr(a.c,5+od(a.ai),5+od(a.ag),1,1,a.h,a.iu,1)if a.u then spr(59,5+od(a.ai),5+od(a.ag),1,1,a.h,a.iu,1)end if a.p then local p=a.p spr(p.c,5+(p.o-a.o)*8+od(a.ai)+p.iv,7+(p.i-a.i)*8+od(a.ag)+p.ow,1,1,p.h,p.iu,1)end clip()camera()end function yf(o,i)local lz=103 local wd=flr(max(min(nr/uv*lz,lz-1),1))camera(-o,-i)op(rect,[[{0,2,@1,3,@2},{1,1,@1,4,0x100d},{@1,0,@1,5,9},{@1,2,@1,3,10},{0,0,@3,5,1}]],wd,hi(0x6c,3),lz)camera()end function mw(o,i,se,oa,flip)oa=oa/se*37+1 local ug,ch=1,oa if flip then oa=39-oa ug,ch=oa,38 end camera(-o,-i)op(rect,[[{0,0,39,3,1},{@1,1,@2,1,11},{@1,2,@2,2,3},{@3,1,@3,2,9},{@3,1,@3,1,10}]],ug,ch,oa)camera()end function gh(o,i,a,flip)if a and a.an then local mu=flr(a.oa).."/"..a.se local rr=o+20 local cp=rr if flip then rr,cp=o-17,o-59 end be(flip and(o-17)or o,i,a)mw(cp,i+7,a.se,a.oa,flip)ng(a.r,md(a.r,rr,flip),i)ng(mu,md(mu,rr,flip),i+13,true)end end function pc()nn(40,107,2,1,1,false,false,1)spr(40,107,2)ng(fy(),116,4)yf(1,3)op(gh,[[{1,108,@1},{126,108,@2,true}]],au,hq)end sh=0 rg=false function fc(vt,o,i)dn(8-sh)if rg then camera(rnd(2)-1,rnd(2)-1)end spr(192,o-16,i-8,4,2)nn(56,o+15,i,1,1,false,false,1)camera()end bp=dw([[{y=@2,ab=.5},{k=@1,y=@2,ab=.5},{k=@4,y=@2,ab=.5},{k=@3,y=@2}]],function()rg=true sh=min(8,sh+8/30)end,fc,function()rg=true sh=max(0,sh-8/30)end,function()rg=false end)sfx(9)ic,it,pj={},0,25 function yo(ib,wr)local ao,l,si,nm="","",ib.." ",{}for s=1,#si do local d=sub(si,s,s)if #l>0 and d==" "then if #(ao..l)>wr then add(nm,ao)ao="" end ao,l=ao..l.." ","" else l=l..d end end add(nm,ao)return nm end function fb(bk)if ar then it+=.5 if it>#ar.sa+#ar.st then it=#ar.sa+#ar.st end if btnp(4)and it>.5 and ar.mn then if it>=#ar.sa+#ar.st then del(ic,ar)ar,it=ic[1],0 else it=#ar.sa+#ar.st end end end end function nx(ib)local nq,r,nk,rf,si="","","","|",ib.."|" local dq=true for s=1,#si do local o=sub(si,s,s)if o=="^"then dq=false elseif o==":"or o=="|" or o=="@"or o=="%"then if rf==":"then local nm=yo(nq,pj)for s=1,#nm do local ao=nm[s]if s%2==1 then add(ic,{nk=nk,r=r,mn=dq,sa=ao,st=""})r="" else ic[#ic].st=ao end end elseif rf=="|" then nk,r=nq,"" elseif rf=="@"then r=nq end rf,nq=o,"" else nq=nq..o end end ar=ic[1]end function gl(o,i)camera(-o,-i)if ar then op(rectfill,[[{0,0,106,19,5},{1,1,105,18,6},{2,2,104,17,0}]])if #ar.nk>0 then local oh=#ar.nk*4+6 op(rectfill,[[{0,-7,@1,0,5},{1,-6,@2,0,6},{2,-5,@3,1,0}]],oh,oh-1,oh-2)ng(ar.nk,4,-3)end op(ng,[[{@1,4,4,false},{@2,4,11,true}]],sub(ar.sa,1,it),sub(ar.st,0,max(it-#ar.sa,0)))if ar.mn then spr(71,100,ha(40)<20 and 13 or 14)end end camera()end function lr()ic,it,ar={},0,false end function gq()yg,pq=ar,ic lr()end function gp()lr()ic,ar=pq,yg end function cy(ia,pk,aw,da,my,am,a,ur,sc)local up=function(ia,ux)return flr(ia-ux),-flr(-(ia+ux))-1 end local uj,ue=up(ia+aw,da)local ph,gf=up(pk,my)for cq=ph,gf do if aw<0 and sc(uj,cq)then ur(a,am)return uj+da+1,0 elseif aw>0 and sc(ue,cq)then ur(a,am+1)return ue-da,0 end end return ia,aw end function yp(...)sk,ro,hy,hk,cz,uf,dh,ya=...end function po(o,i)lo,lh=o-8,i-8 cc(o,i)end function ca(ry,ob,sw,he)if ry<ob+cz then ob=ry-cz end if ry>ob+uf then ob=ry-uf end if ob<sw then ob=sw end if ob+16>sw+he then ob=sw+he-16 end if he<16 then ob=he/2-8+sw end return ob end function cc(pn,yd)lo,lh=ca(pn,lo,sk,hy),ca(yd,lh,ro-dh,hk+dh+ya)end function oq(o)return(o+uy)*8-flr(lo*8)end function ok(i)return flr(mm*8)+(i*8)-flr(lh*8)end function mv(ou,id,oh,nj,z)rect(oq(ou),ok(id),oq(oh)-1,ok(nj)-1,z)end function bu(ou,id,oh,nj,z)rectfill(oq(ou),ok(id),oq(oh),ok(nj),z)end function vr(fx,o,i,z)print(fx,oq(o),ok(i),z)end function yh(fu,we,yz,pv,...)map(fu,we,oq(yz),ok(pv),...)end function va(ou,id,oh,nj)clip(oq(ou),ok(id),(oh-ou)*8,(oh-ou)*8)end function vl(o,i,as,z)circfill(oq(o),ok(i),as*8,z)end function bb(o,i,as,z)circ(oq(o),ok(i),as*8,z)end function ri(a)ak.du(a.o,a.i,a.at,a.aa)end ak.on=function(o,i)return ad([[r="on",b={ne=true,o=@1,i=@2,f=.375,m=.375,ow=-2,iz={120,121},ov=1,ay=true,oj=@9},v={"ik","ac","ih","oo","z","nh","nw","ox","ij","al"},x={{y=@7,s=@4,aj=az,k=az,ab=1.5},{y=@7,s=@8,aj=az,k=@5,ab=.5},{y=@7,s=@6,aj=@3,k=az,ab=1}}]],o,i,function(a,g,...)if g.u then g.ly(g,10)g.sj(g,30)end if g.ox then g.nl(g,.3,...)end if not g.mr then gm(a,1)end end,function(a)a.ai,a.ag=0,0 a.sl=0 end,function(a)a.h=au.o<a.o end,function(a)cv(a,au,.06)end,hm,function(a)a.sl=1 end,ri)end ak.yk=function(o,i)return ad([[r="yk",b={ne=true,o=@1,i=@2,f=.375,m=.375,iz={122,123},ov=2,hr=10,oj=@4,ay=false},v={"ik","ac","ih","oo","z","nw","ox","ij","al"},x={{s=@3,ab=1.5}}]],o,i,function(a)a.ai=.01 end,ri)end ak.ff=function(o,i)return ad([[r="ff",b={ne=true,o=@1,i=@2,f=.375,m=.375,iz={74},oj=@4,ov=1},v={"ik","ac","ih","oo","z","nh","nw","ox","ij","al"},x={{s=@3,ab=1.5}}]],o,i,function(a)a.ag=.01 a.ai=.005 end,ri)end ak.wh=function(o,i)return ad([[r="wh",b={ne=true,o=@1,i=@2,f=.375,m=.375,iz={91},ov=1,oj=@4,ay=false},v={"ik","ac","ih","oo","z","nw","ox","ij","al"},x={{s=@3,ab=1.5}}]],o,i,function(a)a.ai=sin(t())/50 a.h=sgn(a.ai)<1 end,ri)end ak.cr=function(o,i)return ad([[r="cr",b={ne=true,o=@1,i=@2,f=.375,m=.375,iz={46},oj=@4,ov=1},v={"ik","ac","ih","oo","z","nh","nw","ox","ij","al"},x={{s=@3,ab=1.5}}]],o,i,function(a)a.ag=sgn(rnd(1)-.5)*.01 a.ai=sgn(rnd(1)-.5)*.01 a.h=sgn(a.ai)<1 end,ri)end ak.af=function(o,i,is,f,m,c)return ad([[r="af",b={o=@1,i=@2,is=@3,bd=@4,ve=@5,hz=@6,s=@7,oj=@8,c=@9,ow=-4,oz=2,oc=2},v={"ac","al"}]],o,i,is,f,m,function(a,g)if g.u then lg(is,f,m,'k')end end,function(a)a.fr=lm(a.o-.75,a.i,.25,.5)a.mz=lm(a.o+.75,a.i,.25,.5)a.gj=lm(a.o,a.i-5/8,1,.25)a.sx=ny(a.o,a.i+1/8,.5,5/8,a.hz)end,function(a)a.fr.an,a.mz.an,a.gj.an,a.sx.an=false end,c or 98)end ak.nd=function(o,i,lx)return ad([[r="nd",b={c=51,f=.5,m=.5,o=@1,i=@2,lx=@3,s=@4},v={"ac","al","ho"}]],o,i,lx,function(a)a.sx=ny(a.o,a.i+1,7/8,.5,function(a,g)if btnp(4)and sz=="sv"then nx(lx)end end)end)end ak.du=function(o,i,at,aa)return ad([[r="du",b={c=40,f=.375,m=.375,o=@1,i=@2,at=@3,aa=@4,ay=false,aj=@5,},v={"ik","ac","nh","al","z","oo"},x={{ab=5},{s=@6}}]],o,i,at,aa,function(a,g)if g.u then ye(10)a.an=false end end,function(a)a.an=false end)end function lm(o,i,f,m)return ad([[r="bg",b={o=@1,i=@2,f=@3,m=@4,sg=true,ay=true},v={"ac","ho"}]],o,i,f,m)end function ny(o,i,f,m,hz)return ad([[r="bv",b={o=@1,i=@2,f=@3,m=@4,cl=@5},v={"ac","sx"}]],o,i,f,m,hz)end ak.cw=function(o,i,ma)return ad([[r="cw",b={o=@1,i=@2,f=.375,m=.375,c=42,h=@3,ay=false,ai=@4},v={"ac","oo","z","al"},x={{aj=@5,ab=3},{s=@6}}]],o,i,ma,ma and-.1 or.1,function(a,g)if g.ne then ci(g)ii("nl",g,(a.og==1)and.3 or.1,a.h and-1 or 1,0)ii("sj",g,30)ii("ly",g,1)a.an=false end end,function(a)a.an=false end)end ak.nu=function(o,i)return ad([[r="nu",b={c=49,f=.375,m=.375,o=@1,i=@2,ay=true,},v={"ik","ac","nh","al","z","oo"},]],o,i)end ak.hb=function(o,i)return ad([[r="hb",b={c=108,f=.5,m=.5,ow=-2,o=@1,i=@2,s=@3,k=@4},v={"ac","al","ho"}]],o,i,function(a)local ah=function()if btnp(4)and sz=="sv"then nx("|lark:heya lank, i'm yer biggest fan!")end end local hn=6/8 ny(a.o+1,a.i,.5,hn,ah)ny(a.o-1,a.i,.5,hn,ah)ny(a.o,a.i+1,hn,.5,ah)ny(a.o,a.i-1,hn,.5,ah)end,function(a)a.h=a.o-au.o>0 end)end function np(a,dx,cs)if a.poke>0 then a.poke-=1 a.iv=a.h and dx or-dx else a.iv=a.h and cs or-cs end end function bt()sz="sv" iq=1 ot={}no=ol([[fq={ah=@1,c=09,av="|^sword:hurts bad guys."},gv={ah=@2,c=08,av="|^banjo:play a sick tune!"},yq={ah=@3,c=14,av="|^shield:be safe from enemy attacks."},pr={ah=@4,c=12,av="|^brang:stun baddies. get items."},fk={ah=@5,c=11,av="|^shovel:dig things up. kill the grass."},dp={ah=@6,c=13,av="|^bomb:only 5 power squares to blows things up!"},pd={ah=@7,c=15,av="|^bow:shoots enemies. needs 2 power squares."},fe={ah=@8,c=10,av="|^sqr'force:don't let ivan take it from you!"},sv={c=43,av="|^interact:talk to people, pick up things, read signs."},bj={c=44,av="|^letter:dinner is ready for a special someone."},bn={c=45,av="|^soul:the soul of an angry family member."},cr={c=46,av="|^chicken:looks delicious."},le={c=47,av="|^key:i wonder what it opens."},gb={c=43,av="|^empty:there is no item in this space."}]],pu,wo,ww,yb,gn,pg,fg,wn)add(ot,"sv")add(ot,"pd")add(ot,"fk")add(ot,"fq")add(ot,"gv")add(ot,"yq")add(ot,"pr")add(ot,"dp")add(ot,"fe")end gs={5,4,6,2,8,1,3,7,9}yu={6,4,7,2,1,3,8,5,9}function un(nf)local ms=gs[nf]-1 return ms%3,flr(ms/3)end function ga()if not rp and btn(5)then gq()nx(no[ot[iq]].av)end if rp and not btn(5)then gp()sz,iq=ot[iq]or "sv",1 end rp=btn(5)if rp then if au.p then au.p.ax=false end local o,i=un(iq)if btnp(0)then o-=1 end if btnp(1)then o+=1 end if btnp(2)then i-=1 end if btnp(3)then i+=1 end o,i=max(0,min(o,2)),max(0,min(i,2))local rx=yu[i*3+o+1]if iq!=rx then lr()if ot[rx]then nx(no[ot[rx]].av)else nx(no.gb.av)end end iq=rx end end function wf(o,i,c,dm)camera(-o,-i)local uq,color=hi(0x9a,1),9 if dm then uq,color=hi(0xd6,2),13 end op(rectfill,[[{-7,-7,6,6,1},{-6,-6,5,5,@1},{-5,-5,4,4,@2}]],color,uq)fillp()if dm then for s=1,15 do pal(s,wz[s])end end nn(c,-4,-4,1,1,false,false,1)spr(c,-4,-4)pal()camera()end function yx(o,i)local cg,mi=0,0 for nf=1,9 do local p=ot[nf]local wc,ge=un(nf)local rn,rj=(o-16+wc*16),(i-16+ge*16)if nf==iq then cg=rn-4 mi=rj-4 end if p then wf(rn,rj,no[p].c,nf!=iq)else rectfill(rn-1,rj-1,rn,rj,1)end end local fj=(t()*60%60>40)and 38 or 39 local fz=function(ou,id,...)spr(fj,cg+ou,mi+id,...)end op(fz,"{-5,-5,1,1,false,false},{5,-5,1,1,true,false},{5,5,1,1,true,true},{-5,5,1,1,false,true}")end function pg(u)return ad([[r="bi",b={ax=true,f=.375,m=.375,c=13,h=@1},v={"ac","z","oo","al"},x={{s=@2,k=@3}}]],u.h,function(a)a.o,a.i=u.o,u.i end,function(a)if btnp(1)then a.an=false end end)end function yb(u)return ad([[r="bh",b={ax=true,f=.375,m=.375,iz={12,68,69,70},ov=4,hr=10,h=@1,ay=false},v={"ac","ij","z","oo","al"},x={{aj=@2,s=@3,k=@4,ab=.25},{aj=@2,s=@5,k=@6}}]],u.h,function(a,g)if g.ne then if g.ox then g.nl(g,.05,a.h and-1 or 1,0)end if g.ih then g.sj(g,60)end if a.og==1 then return true end elseif g.u then if a.og==2 then a.an=false u.p=false end end end,function(a)a.o,a.i=u.o,u.i a.ai=a.h and-.07 or.07 end,function(a)ie(.75)if nb or not a.ax then end end,function(a)end,function(a)ie(.5)cv(a,u,.07)end)end function ww(u)local ip=.625 return ad([[r="bm",b={mr=true,ax=true,f=.25,m=.5,ow=-1,poke=20,c=14,h=@1,ay=false},v={"ac","iy","spr","z","al"},x={{aj=@2,s=@3,k=@4,ab=.4},{aj=@2,s=az,k=@5}}]],u.h,function(a,g)if g.ne then a.poke=10 ie(.25)if g.ox then local gx=(a.og==1)and.4 or.2 g.nl(g,gx,a.h and-1 or 1,0)u.nl(u,.1,a.h and 1 or-1,0)end if a.og==1 and g.ih then g.sj(g,60)end end end,function(a)a.oi=a.h and-ip/10 or ip/10 a.iv=a.h and-3 or 3 a.poke=20 end,function(a)ie(.75)np(a,0,1)if abs(a.oi+a.of)<ip then a.of+=a.oi else local sn=-ip a.oi,a.of=0,a.h and sn or ip end end,function(a)ie(.25)np(a,0,1)if not a.ax then a.an,u.p=false end end)end function wo(u)return ad([[r="gu",b={ax=true,f=.3,m=.3,c=8,h=@1,ay=false,s=@2,k=@3},v={"ac","iy","spr","z","al"}]],u.h,function(a)a.ss=0 end,function(a)if not a.ax then a.an,u.p=false end end)end function gn(u)return ad([[r="bz",b={ax=true,f=.3,m=.3,c=11,h=@1,ay=false,s=@2,k=@3},v={"ac","iy","al"}]],not u.h,function(a)a.of=a.h and 5/8 or-5/8 a.ss=0 end,function(a)local ae=mget(a.o,a.i)if ae==16 or ae==17 or ae==18 or ae==19 or ae==20 then mset(a.o,a.i,25)end if not a.ax then a.an,u.p=false end end)end function wn(u)return ad([[r="vo",b={ax=true,f=.3,m=.3,c=10,h=@1,oj=@2,k=@3,ay=false},v={"ac","iy","al"}]],u.h,function(a)local s=flr(rnd(5))+1 lg(ll[s].is,ll[s].o,ll[s].i)end,function(a)if not a.ax then a.an=false end end)end function pu(u)return ad([[r="vc",b={ax=true,f=.5,m=.375,ss=0,ow=-2,c=9,poke=0,h=@1,ay=false},v={"ac","iy","spr","z","al"},x={{aj=@2,s=@3,k=@4,ab=.4},{aj=@2,s=az,k=@5}}]],u.h,function(a,g)if g.ne then a.poke=10 ie(.5)ci(g)if g.ox then g.nl(g,(a.og==1)and.3 or.1,a.h and-1 or 1,0)u.nl(u,.3,a.h and 1 or-1,0)end ii("sj",g,30)ii("ly",g,55)end end,function(a)a.oi=a.h and-.125 or.125 a.iv=a.h and-1 or 1 a.poke=20 end,function(a)ie(.75)np(a,-1,0)if abs(a.oi+a.of)<1 then a.of+=a.oi else local sn=-1 a.oi,a.of=0,a.h and sn or 1 end end,function(a)ie(.25)np(a,-1,0)if not a.ax then a.an,u.p=false end end)end function fg(u)return ad([[r="bc",b={ax=true,f=.5,m=.375,ss=0,ow=-1,c=15,h=@1,oj=@5,ay=false},v={"ac","iy","al"},x={{s=@2,k=@3,ab=.4},{s=az,k=@4}}]],u.h,function(a)a.oi=a.h and-.125 or.125 a.iv=a.h and-1 or 1 a.poke=20 end,function(a)ie(.75)np(a,-1,0)local ip=3/8 if abs(a.oi+a.of)<ip then a.of+=a.oi else local sn=-ip a.oi,a.of=0,a.h and sn or ip end end,function(a)ie(.25)np(a,-1,0)if not a.ax then a.an,u.p=false end end,function(a)if ud(1)then ak.cw(a.o,a.i,a.h)end end)end function cv(ws,im,aw)wp(ws,aw,im.o,im.i)end function wp(a,aw,o,i)local dd=atan2(o-a.o,i-a.i)a.ai,a.ag=aw*cos(dd),aw*sin(dd)end function bq(a,q)return mo("o",a,q)and mo("i",a,q)end function mo(ix,a,q)local dc,ub,co,ui=a[ix],q[ix],a["as"..ix],q["as"..ix]return dc>ub-ui-co and dc<ub+ui+co end function vn(a,q)return a.o<q.o+q.f and a.o>q.o-q.f and a.i<q.i+q.m and a.i>q.i-q.m end function pi()return ad([[r="bs",b={c=59,ow=-2,k=@1},v={"iy","al"}]],function(a)a.h=au.h a.an=au.an end)end function wy(o,i)pi()return ad([[r="u",b={o=@1,i=@2,iz={56,57,58,59},f=.375,m=.375,um=.25,dj=.25,ow=-2,aw=.02,ov=3,hr=5,se=50,oa=50,k=@4,y=@5,aj=@3,oj=@6},v={"ij","z","oo","nh","nw","ox","ih","al"}]],o,i,function(self,g,hu,uh)end,function(a)if a.ns==0 then if not btn(5)and not(btn(0)and btn(1))then if btn(0)then if not a.p then a.h=true end a.ai=-a.aw elseif btn(1)then if not a.p then a.h=false end a.ai=a.aw else a.ai=0 end else a.ai=0 end if not btn(5)and not(btn(2)and btn(3))then if btn(2)then a.ag=-a.aw elseif btn(3)then a.ag=a.aw else a.ag=0 end else a.ag=0 end end if btn(4)and not btn(5)and not a.p and not nb then if sz!="dp"or ud(5)then a.p=pf(a,sz)else end end local p=a.p if p then if not p.an then a.p=nil end if nb or(not btn(4)or btn(5))then p.ax=false end if p.r=="gu"then a.ai=0 a.ag=0 else a.ai/=2 a.ag/=2 end end a.hv=nil if flr((abs(a.at)+abs(a.aa))*50)>0 then a.ov=3 else a.ov=1 end if a.ns!=0 then if a.p then a.p.nc=a.nc end end end,hm,function(a)if a.p then a.p.an=false end end)end function pf(u,lf)return no[lf]and no[lf].ah and no[lf].ah(u)end uv,nr,nb=100,100,false hq,br=nil,0 rt=0 function ye(il)rt=min(rt+il,999)end function ud(il)if rt-il>=0 then rt-=il return true end end function fy()local lt="00"..rt return sub(lt,#lt-2,#lt)end function yw(il)nr=min(uv,nr+il)if nb and nr>=100 then nb=false end end function ie(il)if nr-il>=0 then nr=nr-il else nb=true end end function ci(gy)hq=gy wt("bl",60*3,function()hq=nil end)end rb=false function _init()poke(0x5f34,1)wz=ol("5,5,13,13,5,6,6,6,6,6,6,6,13,6,6")ys=ol("1,2,3,4,5,6,7,8,9,10,11,12,13,14,15")gk=ys cn=dw([[{s=@1,k=@2,y=@3}]],wu,gd,mg)bt()end function _update60()if btnp(5)then rb=not rb end mt(cn)fb()end function _draw()cls()ii("y",cn)gl(20,107)if rb then ng(stat(1),104,102)end end function gd()fi()ga()fl()if not ar and not re then op(su,[[{"rm","fa"},{"ih","yy"},{"ir","fs"},{"oo","pz"},{"z","sy",@1},{"z","sy",@4},{"sx","wm",@3},{"nh","gg",@2},{"iy","wq",@3},{"ni","gz"},{"ik","py"},{"ir","wb"},{"ij","bo"},{"dg","mk"}]],io["z"],function(o,i)return o>=sk and o<sk+hy and i>=ro and i<ro+hk and fget(mget(o,i),1)end,au,io["ho"])yw(.25)mx()else if au.p then au.p.an=false end au.p=nil end cc(au.o,au.i)yc()end dt=0 hl=0 di=0 function yc()if di>0 then dt=lq()/8 hl=lq()/8 di-=1 else dt,hl=0,0 end end function mb(oe)di=oe end function mg()wx(ra+8+dt,sr+7+3/8+hl)if rp then yx(64,59)end if rb then su("sf","wa")end pc()end function bx()cd=flr(rnd(0x1f00))+0x6040 pw=cd+flr(rnd(0x4)-0x2)li=flr(rnd(0x40))memcpy(cd,pw,li)end function wu()gi()au=wy(0,0)cb("iw",21,29)nx("|lank:12341234561 1901234567890 234123456 8901234567890hh ")end