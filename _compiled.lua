function a(b)return b==0 and 0 or sgn(b)end function c()return flr(rnd(3))-1 end function d(e,f)for g,h in pairs(f or{})do e[g]=h end end function i(j,k,...)if k and k[j]then return k[j](k,...)end end function l(m,k)foreach(k,function(t)m(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])end)end function o(m,...)l(m,p(...))end function q(r,s,u)local v,w,x,y,z,aa={},"",1,true while s<=#r do local ab=sub(r,s,s)if ab=="\""then aa,y=not aa elseif ab=="|" then elseif aa then w=w..ab elseif ab=="}"or ab==","then if type(w)=="k"or not y then elseif sub(w,1,1)=="@"then local ac=tonum(sub(w,2,#w))assert(ac!=nil)if not u[ac]then u[ac]={}end add(u[ac],{v,z or x})elseif w=="ad"then w=function()end elseif w=="true"or w=="false"then w=w=="true" elseif w=="nil"or w==""then w=nil elseif y then w=tonum(w)end v[z or x],y,w,x,z=w,true,"",z and x or x+1 if ab=="}"then return v,s end elseif ab=="{"then w,s,y=q(r,s+1,u)elseif ab=="="then y,z,w=true,w,"" elseif ab!=" "and ab!="\n"then w=w..ab end s+=1 end return v,s,u end ae={}function p(r,...)if not ae[r]then ae[r]={q(r..",",1,{})}end local af,ag={...},ae[r]for g,h in pairs(ag[3])do foreach(ag[3][g],function(ab)ab[1][ab[2]]=af[g]end)end return ag[1]end function ah(ai,...)if ai.aj==0 then ai.ak=ai.al ai.al=(ai.ak%#ai.am)+1 ai.aj=ai.am[ai.ak]and ai.am[ai.ak].an or nil d(ai,ai.am[ai.ak])i("s",ai,...)end if i("ao",ai,...)then ai.aj=0 end if ai.aj then ai.aj=max(0,ai.aj-1/60)end end function ap(ai,b)ai.aj=0 if b then ai.al=b end end function aq(ai,am)d(ai,p([[ar=true,am=@1,as=0,ak=0,al=1,aj=0]],am or{}))return ai end function at(...)return aq({},p(...))end function au()for s=1,15 do pal(s,av[s])end end function aw(ax,ay)(ay or spr)(ax.az,ba(ax.ab-ax.bb*.5)+ax.bc+ax.bd,be(ax.bf-ax.bg*.5)+ax.bh+ax.bi,ax.bb,ax.bg,ax.bj,ax.bk,1)end function bl(ax)aw(ax,bm)end bn={}function bo(az,bb,bg)local bp=bg*8-1 local bq,br={},function(ab,bf)return mid(0,ab,bp)==ab and sget(ab+az*8%128,bf+flr(az/16)*8)!=0 end local bs=function(ab)local bt,bu for s=0,bp do bt,bu=bt or br(ab,s)and s-1,bu or br(ab,bp-s)and bg*8-s end return{bt=bt or bg*8+2,bu=bu or 0}end bn[az]={}for s=0xffff,bb*8 do local bv,bw,n=bs(s-1),bs(s),bs(s+1)local bt,bu=min(min(bv.bt,bw.bt),n.bt),max(max(bv.bu,bw.bu),n.bu)if bu>=bt then add(bn[az],{bx=s,by=bt,bz=s,ca=bu})end end end function bm(az,ab,bf,bb,bg,bj,bk,cb)if not bb then bb=1 end if not bg then bg=1 end local cc,cd,ce,cf=ab,1,bf,1 if bj then cc,cd=bb*8-1+ab,0xffff end if bk then ce,cf=bg*8-1+bf,0xffff end if not bn[az]then bo(az,bb,bg)end foreach(bn[az],function(cg)rectfill(cc+cd*cg.bx,ce+cf*cg.by,cc+cd*cg.bz,ce+cf*cg.ca,cb)end)end function ch(ci,ab,cj)return ab-(cj and(#ci*4+1)or 0)end function ck(ci,ab,bf,cl)print(ci,ab,bf+(cl and 1 or-1),1)print(ci,ab,bf,7)end cm=p([[{0,0,0,0,0,0,0},{1,1,1,0,0,0,0},{2,2,2,1,0,0,0},{3,3,3,1,0,0,0},{4,2,2,2,1,0,0},{5,5,1,1,1,0,0},{6,13,13,5,5,1,0},{6,6,13,13,5,1,0},{8,8,2,2,2,0,0},{9,4,4,4,5,0,0},{10,9,4,4,5,5,0},{11,3,3,3,3,0,0},{12,12,3,1,1,1,0},{13,5,5,1,1,1,0},{14,13,4,2,2,1,0},{15,13,13,5,5,1,0}]])function cn(s)for bw=0,15 do if flr(s+1)>=8 then pal(bw,0)else pal(bw,cm[bw+1][flr(s+1)])end end end co,cp={},{}function cq(...)local af=p(...)cp[af.cr]=function(ax)return cs(af,ax or{})end end function ct(...)return cs(p(...))end function cs(cu,ax)foreach(cu.cv,function(cw)ax=cp[cw](ax)end)d(ax,cu.cx)local cr=cu.cr if not ax[cr]then co[cr]=co[cr]or{}add(co[cr],ax)end ax.cr,ax[cr]=cr,true aq(ax,cu.ai)return ax end function cy(cr,m,...)for ax in all(co[cr])do if ax[m]then ax[m](ax,...)end end end function cz(ax)for g,h in pairs(co)do if ax[g]then del(h,ax)end end end cq([[cr="da",cx={db=true,dc=0,s=ad,ao=ad,dd=@1,de=@2,df=ad,dg=@3}]],function(ax)if ax.db and ax.dc==0 then ah(ax)end end,function(ax)if not ax.db then ax:df()ax:dg()end end,function(ax)cz(ax)end)cq([[cr="dh",cx={},cv={"da"}]])cq([[cr="di",cx={dj=@1},cv={"da"}]],function(ax)local dk=dl[dm]if ax.ab+ax.dn<dk.ab+.5 then ax.ab=dk.ab+.5 ax.dn=0 end if ax.ab+ax.dn>dk.ab+dk.dp-.5 then ax.ab=dk.ab+dk.dp-.5 ax.dn=0 end if ax.bf+ax.dq<dk.bf+.5 then ax.bf=dk.bf+.5 ax.dq=0 end if ax.bf+ax.dq>dk.bf+dk.dr-.5 then ax.bf=dk.bf+dk.dr-.5 ax.dq=0 end end)cq([[cr="ds",cx={t=0,an=0,dt=@1},cv={"da"}]],function(ax)ax.t+=1 end)cq([[cr="du",cx={ab=0,bf=0},cv={"da"}]])cq([[cr="dv",cx={dn=0,dq=0,dw=@1},cv={"du"}]],function(ax)ax.ab+=ax.dn ax.bf+=ax.dq end)cq([[cr="dx",cx={dy=.85,dz=.85,ea=0,eb=0,ec=@1},cv={"dv"}]],function(ax)ax.dn+=ax.ea ax.dq+=ax.eb ax.dn*=ax.dy ax.dq*=ax.dz if ax.ea==0 and abs(ax.dn)<.01 then ax.dn=0 end if ax.eb==0 and abs(ax.dq)<.01 then ax.dq=0 end end)cq([[cr="ed",cx={ee=.375,ef=.375,eg=@1},cv={"du"}]],function(ax)eh(ax.ab-ax.ee,ax.bf-ax.ef,ax.ab+ax.ee,ax.bf+ax.ef,8)end)cq([[cr="ei",cx={ej=0,ek=0,el=0,em=0,en=@1},cv={"da"}]],function(ax,eo)ax.ab,ax.bf,ax.dn,ax.dq=eo.ab+ax.ej,eo.bf+ax.ek,eo.dn+ax.el,eo.dq+ax.em ax.bd,ax.bi=eo.bd,eo.bi end)cq([[cr="ep",cx={bc=0,bh=0,bd=0,bi=0,eq=ad,er=@1},cv={"da"}]],function(ax)ax.bd,ax.bi=0,0 end)cq([[cr="spr",cx={az=0,bb=1,bg=1,bj=false,bk=false,es=@1},cv={"dv","ep"}]],aw)cq([[cr="et",cx={eu=@1},cv={"spr"}]],bl)cq([[cr="ev",cx={ew=@1},cv={"dx"}]],function(ax,ex,ey,ez)fa(15)if ey!=0 then ax.dn=ey*ex else ax.dq=ez*ex end end)cq([[cr="fb",cx={fc=@1,fd=@2},cv={"dx","ep"}]],function(ax,fe)if ax.dc==0 then ax.dc=fe end end,function(ax)if ax.dc!=0 then ax.eb,ax.ea=0,0 ax.bd=c()ax.dc-=1 end end)cq([[cr="ff",cx={fg=33,fh=33,fi=@1},cv={"da"}]],function(ax,fj)ax.fg=min(ax.fh,ax.fg-fj)if ax.fg<=0 then ax.db=false end end)cq([[cr="fk",cx={fl={},fm=1,fn=0,fo=1,fp=0,fq=nil,fr=@1},cv={"spr","ds"}]],function(ax)if ax.fq then ax.az=ax.fq else if ax.t%ax.fp==0 then ax.fn+=1 ax.fn%=ax.fo end ax.az=ax.fl[ax.fm+ax.fn]or 0xffff end end)cq([[cr="fs",cx={ft=true,fu=true,fv=true,fw=ad},cv={"dv","ed"}]])cq([[cr="fx",cx={fy=ad,fz=@1},cv={"dv","ed"}]],function(ax,ga)if ga.ab-ga.ee>ax.ab-ax.ee and ga.ab+ga.ee<ax.ab+ax.ee and ga.bf-ga.ef>ax.bf-ax.ef and ga.bf+ga.ef<ax.bf+ax.ef then ax.fy(ax,ga)end end)cq([[cr="cb",cx={fu=false,fv=true,gb=0,gc=0,fw=ad,gd=@1},cv={"dv","ed"}]],function(ax,ge)local gf={}local gd=function(dn,dq)local gg=false local gh=function(gi,gj,ax,gk,du,gl)if gl!=0 and du<abs(ax[gi]-gk[gi])then if ax.fv and gk.fv then h=ax[gj]+gk[gj]local gm=function(bw)if not bw.fu then bw[gj]=h/2 end end gm(ax)gm(gk)gg=true end gf[gk][gi]=gl>0 and 1 or 0+gl<0 and 0xffff or 0 end end foreach(ge,function(gk)if ax!=gk and(not ax.fu or not gk.fu)then local ab,bf=abs(ax.ab+dn-gk.ab),abs(ax.bf+dq-gk.bf)if ab<(ax.ee+gk.ee)and bf<(ax.ef+gk.ef)then if not gf[gk]then gf[gk]={ab=0,bf=0}end o(gh,[[{"ab","dn",@1,@2,@3,@4},{"bf","dq",@1,@2,@5,@6}]],ax,gk,ab,dn,bf,dq)end end end)if gg then dn*=-ax.gb dq*=-ax.gc end return dn+dq end ax.dn=gd(ax.dn,0)ax.dq=gd(0,ax.dq)for gk,eq in pairs(gf)do ax:fw(gk,eq.ab,eq.bf)gk:fw(ax,-eq.ab,-eq.bf)end end)cq([[cr="gn",cx={"go"=ad,"gp"=@1},cv={"dv","ed"}]],function(ax,gq)ax.ab,ax.dn=gr(ax.ab,ax.bf,ax.dn,ax.ee,ax.ef,0,ax,ax.go,gq)ax.bf,ax.dq=gr(ax.bf,ax.ab,ax.dq,ax.ef,ax.ee,2,ax,ax.go,function(bf,ab)return gq(ab,bf)end)end)FPS=60 function gs(gt)return flr(t()*FPS)%(gt or 0)end gu={}function gv(gw,gx,gy)gu[gw]={gz=gs()+gx,m=gy}end function ha()for g,h in pairs(gu)do if h.gz-gs()<=0 then i("m",h)del(gu,h)end end end hb=p([[{ab=02,bf=12,hc="hd"},{ab=52,bf=60,hc="he"},{ab=69,bf=17,hc="hf"},{ab=123,bf=14,hc="hg"},{ab=123,bf=60,hc="hh"}]])function hi()dl=p([["hj"={n="hj",bw=03,t=10,ab=000,bf=00,dp=128,dr=64},"hk"={n="hl",bw=03,t=10,ab=000,bf=16,dp=64,dr=16,hm={"hn",063,36}},"ho"={n="hl",bw=03,t=17,ab=000,bf=16,dp=32,dr=16,hm={"hn",063,38},cg={"hp",033,29},{"hq",16,18.5,"hr",28,15},{"hq",20,24.5,"hs",12,15},{"hq",12,24.5,"ht",12,07},{"hq",06,22.5,"hd",04,15},{"hq",26,22.5,"hu",20,15},{"hv",14.5,19.5,"|sign:mayor lank's home"},{"hv",18.5,24.5,"|sign:bob and bobett's home"},{"hv",13.5,24.5,"|sign:hiroll shop"},{"hv",04.5,22.5,"|sign:ole banjo's house"},{"hv",27.5,22.5,"|sign:hiroll tutorial"},{"hw",14,28}},"hp"={n="hl",bw=03,t=17,ab=032,bf=16,dp=32,dr=16,hm={"ho",031,29},cg={"hx",033,02}},"hn"={n="hy",bw=03,t=10,ab=048,bf=32,dp=16,dr=08,cg={"ho",001,29},hm={"hz",063,44},ao={"ia",040,62},eq={"ia",040,54},{"hq",60,34.5,"ib",28,15},{"hv",58.5,34.5,"|sign:lark's house"}},"hz"={n="hy",bw=03,t=10,ab=048,bf=40,dp=16,dr=08,cg={"hn",049,36},hm={"ia",046,58},ao={"ia",040,62},eq={"ic",060,49}},"ic"={n="hy",bw=03,t=10,ab=048,bf=48,dp=16,dr=08,cg={"ia",034,58},hm={"he",063,60},ao={"hz",060,47},eq={"ia",040,54}},"he"={n="hy",bw=03,t=10,ab=048,bf=56,dp=16,dr=08,cg={"ic",049,52},hm={"ia",046,58},ao={"id",040,51},eq={"ia",040,54},{"hq",56,58.5,"ie",20,07},{"bt",56,60}},"id"={n="hy",bw=03,t=10,ab=032,bf=40,dp=16,dr=12,ao={"ig",040,39},eq={"he",052,57}},"ig"={n="hy",bw=03,t=10,ab=032,bf=32,dp=16,dr=08,eq={"id",040,41}},"ia"={n="hy",bw=03,t=10,ab=032,bf=52,dp=16,dr=12},"hx"={n="ih",bw=13,t=10,ab=032,bf=00,dp=16,dr=08,hm={"hp",063,29},cg={"ii",097,29}},"ii"={n="ih",bw=13,t=10,ab=096,bf=00,dp=16,dr=32,hm={"hx",047,06},cg={"ij",033,12},{"hq",100,27.5,"ik",04,07}},"ij"={n="ih",bw=13,t=10,ab=032,bf=08,dp=16,dr=08,hm={"ii",111,29},cg={"il",049,12}},"il"={n="im",bw=04,t=10,ab=048,bf=00,dp=16,dr=16,hm={"ij",047,12},cg={"io",085,30}},"io"={n="im",bw=04,t=10,ab=084,bf=12,dp=12,dr=20,hm={"il",063,04},ao={"ip",088,11}},"ip"={n="im",bw=04,t=10,ab=080,bf=00,dp=16,dr=12,eq={"io",090,13},{"hq",088,01.5,"iq",69,31,102}},"ir"={n="is",bw=13,t=10,ab=112,bf=24,dp=16,dr=08,eq={"ii",104,04},ao={"hg",120,23}},"hg"={n="is",bw=13,t=10,ab=112,bf=12,dp=16,dr=12,eq={"ir",120,25},ao={"it",120,11}},"it"={n="is",bw=13,t=10,ab=112,bf=00,dp=16,dr=12,eq={"hg",120,13}},"iq"={n="iu",bw=13,t=10,ab=064,bf=22,dp=10,dr=10,eq={"ip",088,02},cg={"iv",075,27}},"iv"={n="iu",bw=13,t=10,ab=074,bf=22,dp=10,dr=10,hm={"iq",073,27},ao={"hf",079,21}},"hf"={n="iu",bw=13,t=10,ab=064,bf=12,dp=20,dr=10,eq={"iv",079,23},ao={"iw",072,11}},"iw"={n="iu",bw=13,t=10,ab=064,bf=00,dp=16,dr=12,eq={"hf",072,13}},"hh"={n="ix",bw=13,t=10,ab=112,bf=56,dp=16,dr=08,hm={"iy",111,60},ao={"iz",120,55}},"iy"={n="ix",bw=13,t=10,ab=096,bf=44,dp=16,dr=20,cg={"hh",113,60}},"iz"={n="ix",bw=13,t=10,ab=112,bf=44,dp=16,dr=12,eq={"hh",120,57},ao={"ja",120,43}},"ja"={n="ix",bw=13,t=10,ab=112,bf=32,dp=16,dr=12,eq={"iz",120,45}},"ik"={n="hq",bw=04,t=10,ab=000,bf=00,dp=08,dr=08,eq={"ii",100,28}},"ht"={n="hq",bw=04,t=10,ab=008,bf=00,dp=08,dr=08,eq={"ho",012,25}},"ie"={n="hq",bw=03,t=10,ab=016,bf=00,dp=08,dr=08,eq={"he",056,59}},"jb"={n="hq",bw=04,t=10,ab=024,bf=00,dp=08,dr=08,eq={"hr",028,09}},"jc"={n="hq",bw=04,t=10,ab=024,bf=00,dp=08,dr=08,eq={"ib",028,09},{"jd",25.5,1.5},{"jd",25.5,6.5},{"jd",30.5,1.5},{"jd",30.5,6.5}},"hd"={n="hq",bw=04,t=10,ab=000,bf=08,dp=08,dr=08,eq={"ho",006,23}},"hs"={n="hq",bw=04,t=10,ab=008,bf=08,dp=08,dr=08,eq={"ho",020,25}},"hu"={n="hq",bw=04,t=10,ab=016,bf=08,dp=08,dr=08,eq={"ho",026,23}},"hr"={n="hq",bw=04,t=10,ab=024,bf=08,dp=08,dr=08,eq={"ho",016,19},ao={"jb",028,07}},"ib"={n="hq",bw=04,t=10,ab=024,bf=08,dp=08,dr=08,eq={"hn",060,35},ao={"jc",028,07},{"jd",26.5,11.5},{"jd",30.5,13.5},{"hw",28,12.5}},"je"={n="je",bw=03,ab=96,bf=32,dp=11,dr=10},"jf"={n="jg",bw=13,ab=96,bf=32,dp=16,dr=12}]])for g,h in pairs(dl)do h.s=function()l(function(jh,...)cp[jh](...)end,h)end end end ji,jj=0,0 jk=0 function jl(ab,bf)cn(jk)local dk=dl[dm]local jm=min(16,dk.dp)local jn=min(12,dk.dr)local ee=ab-jm/2 local ef=bf-jn/2 ji=-(16-jm)/2+ee jj=-(16-jn)/2+ef for g,h in pairs({5,1,1})do rect(ee*8+g,ef*8+g,(ee+jm)*8-g-1,(ef+jn)*8-g-1,h)end clip(ee*8+4,ef*8+4,jm*8-8,jn*8-8)rectfill(0,0,127,127,dk.bw)jo(dk.ab,dk.bf,dk.ab,dk.bf,dk.dp,dk.dr)jp(co["et"])jp(co["spr"])jp(co["ep"])cy("et","eu")cy("spr","es")clip()cn(0)end function jp(t)for n=2,#t do local s=n while s>1 and t[s].bf<t[s-1].bf do t[s],t[s-1]=t[s-1],t[s]s=s-1 end end end function jq(jr,ee,ef)reload(0x1000,0x1000,0x2000)dm=jr dk=dl[dm]cy("dh","dg")if dk.s then dk.s()end local ab,bf,dp,dr=dk.ab,dk.bf,dk.dp,dk.dr js.ab=ee js.bf=ef jt(ab,bf,dp,dr,5,11,2,2)ju(js.ab,js.bf)end jv=0 jw=0 jx=false function jy(jr,ee,ef,jz)if not jx then jx=true ka=cocreate(function()for s=0,20 do jk=s/20*10 if jz=='ao' then jw=sin(s/80+.5)*10 elseif jz=='eq' then jw=sin(s/80)*10 elseif jz=='hm' then jv=sin(s/80+.5)*10 elseif jz=='cg' then jv=sin(s/80)*10 end yield()end jq(jr,ee,ef)yield()for s=20,0,-1 do jk=s/20*10 if jz=='ao' then jw=sin(s/80)*10 elseif jz=='eq' then jw=sin(s/80+.5)*10 elseif jz=='hm' then jv=sin(s/80)*10 elseif jz=='cg' then jv=sin(s/80+.5)*10 end yield()end jx=false end)end end function kb()local dk=dl[dm]if jx then coresume(ka)elseif dk then local jz=nil if js.bf>kc+kd-.375 then jz='eq' elseif js.bf<kc+.5 then jz='ao' elseif js.ab>ke+kf-.375 then jz='cg' elseif js.ab<ke+.5 then jz='hm' end if jz!=nil and dk[jz]then jy(dk[jz][1],dk[jz][2],dk[jz][3],jz)end end end kg=p([[{kh=0x1040.1040,ki=4,aj=15},{kh=0x1284.1284,ki=4,aj=30},{kh=0x1248.1248,ki=12,aj=10},{kh=0x70e0.b0d0,ki=12,aj=1}]])function kj()foreach(kg,function(ab)if gs(ab.aj)==0 then ab.kh=rotl(ab.kh,ab.ki)end end)end function kk(cb,kh)kh=kg[kh].kh return 0x1000+cb+kh-flr(kh)end function kl(ab,bf,ax)camera(-ab,-bf)o(rectfill,[[{0,0,17,17,5},{1,1,16,16,6},{2,2,15,15,0}]],kk(0x43,4))clip(ab+2,bf+2,14,14)bm(ax.az,5+a(ax.ea),5+a(ax.eb),1,1,ax.bj,ax.bk,1)if ax.ga then bm(59,5+a(ax.ea),5+a(ax.eb),1,1,ax.bj,ax.bk,1)end if ax.km then local km=ax.km bm(km.az,5+(km.ab-ax.ab)*8+a(ax.ea)+km.bc,7+(km.bf-ax.bf)*8+a(ax.eb)+km.bh,1,1,km.bj,km.bk,1)end spr(ax.az,5+a(ax.ea),5+a(ax.eb),1,1,ax.bj,ax.bk,1)if ax.ga then spr(59,5+a(ax.ea),5+a(ax.eb),1,1,ax.bj,ax.bk,1)end if ax.km then local km=ax.km spr(km.az,5+(km.ab-ax.ab)*8+a(ax.ea)+km.bc,7+(km.bf-ax.bf)*8+a(ax.eb)+km.bh,1,1,km.bj,km.bk,1)end clip()camera()end function kn(ab,bf)local ko=103 local kp=flr(max(min(kq/kr*ko,ko-1),1))camera(-ab,-bf)o(rect,[[{0,2,@1,3,@2},{1,1,@1,4,0x100d},{@1,0,@1,5,9},{@1,2,@1,3,10},{0,0,@3,5,1}]],kp,kk(0x6c,3),ko)camera()end function ks(ab,bf,fh,fg,flip)fg=fg/fh*37+1 local kt,ku=1,fg if flip then fg=39-fg kt,ku=fg,38 end camera(-ab,-bf)o(rect,[[{0,0,39,3,1},{@1,1,@2,1,11},{@1,2,@2,2,3},{@3,1,@3,2,9},{@3,1,@3,1,10}]],kt,ku,fg)camera()end function kv(ab,bf,ax,flip)if ax and ax.db then local kw=flr(ax.fg).."/"..ax.fh local kx=ab+20 local ky=kx if flip then kx,ky=ab-17,ab-59 end kl(flip and(ab-17)or ab,bf,ax)ks(ky,bf+7,ax.fh,ax.fg,flip)ck(ax.cr,ch(ax.cr,kx,flip),bf)ck(kw,ch(kw,kx,flip),bf+13,true)end end function kz()bm(40,107,2,1,1,false,false,1)spr(40,107,2)ck(la(),116,4)kn(1,3)o(kv,[[{1,108,@1},{126,108,@2,true}]],js,lb)end lc=0 ld=false function le(lf,ab,bf)cn(8-lc)if ld then camera(rnd(2)-1,rnd(2)-1)end spr(192,ab-16,bf-8,4,2)bm(56,ab+15,bf,1,1,false,false,1)camera()end lg=at([[{eq=@2,an=.5},{ao=@1,eq=@2,an=.5},{ao=@4,eq=@2,an=.5},{ao=@3,eq=@2}]],function()ld=true lc=min(8,lc+8/30)end,le,function()ld=true lc=max(0,lc-8/30)end,function()ld=false end)sfx(9)lh,li,lj={},0,25 function lk(ci,ll)local hm,dp,lm,ln="","",ci.." ",{}for s=1,#lm do local bw=sub(lm,s,s)if #dp>0 and bw==" "then if #(hm..dp)>ll then add(ln,hm)hm="" end hm,dp=hm..dp.." ","" else dp=dp..bw end end add(ln,hm)return ln end function lo(lp)if lq then li+=.5 if li>#lq.lr+#lq.lt then li=#lq.lr+#lq.lt end if btnp(4)and li>.5 and lq.lu then if li>=#lq.lr+#lq.lt then del(lh,lq)lq,li=lh[1],0 else li=#lq.lr+#lq.lt end end end end function lv(ci)local lw,cr,lx,ly,lm="","","","|",ci.."|" local lz=true for s=1,#lm do local ab=sub(lm,s,s)if ab=="^"then lz=false elseif ab==":"or ab=="|" or ab=="@"or ab=="%"then if ly==":"then local ln=lk(lw,lj)for s=1,#ln do local hm=ln[s]if s%2==1 then add(lh,{lx=lx,cr=cr,lu=lz,lr=hm,lt=""})cr="" else lh[#lh].lt=hm end end elseif ly=="|" then lx,cr=lw,"" elseif ly=="@"then cr=lw end ly,lw=ab,"" else lw=lw..ab end end lq=lh[1]end function ma(ab,bf)camera(-ab,-bf)if lq then o(rectfill,[[{0,0,106,19,5},{1,1,105,18,6},{2,2,104,17,0}]])if #lq.lx>0 then local bz=#lq.lx*4+6 o(rectfill,[[{0,-7,@1,0,5},{1,-6,@2,0,6},{2,-5,@3,1,0}]],bz,bz-1,bz-2)ck(lq.lx,4,-3)end o(ck,[[{@1,4,4,false},{@2,4,11,true}]],sub(lq.lr,1,li),sub(lq.lt,0,max(li-#lq.lr,0)))if lq.lu then spr(71,100,gs(40)<20 and 13 or 14)end end camera()end function mb()lh,li,lq={},0,false end function mc()md,me=lq,lh mb()end function mf()mb()lh,lq=me,md end function gr(du,mg,gl,mh,mi,jz,ax,mj,gq)local mk=function(du,ml)return flr(du-ml),-flr(-(du+ml))-1 end local mm,mn=mk(du+gl,mh)local mo,mp=mk(mg,mi)for mq=mo,mp do if gl<0 and gq(mm,mq)then mj(ax,jz)return mm+mh+1,0 elseif gl>0 and gq(mn,mq)then mj(ax,jz+1)return mn-mh,0 end end return du,gl end function jt(...)ke,kc,kf,kd,mr,ms,mt,mu=...end function ju(ab,bf)mv,mw=ab-8,bf-8 mx(ab,bf)end function my(mz,na,nb,nc)if mz<na+mr then na=mz-mr end if mz>na+ms then na=mz-ms end if na<nb then na=nb end if na+16>nb+nc then na=nb+nc-16 end if nc<16 then na=nc/2-8+nb end return na end function mx(nd,ne)mv,mw=my(nd,mv,ke,kf),my(ne,mw,kc-mt,kd+mt+mu)end function ba(ab)return(ab+ji)*8-flr(mv*8)end function be(bf)return flr(jj*8)+(bf*8)-flr(mw*8)end function eh(bx,by,bz,ca,cb)rect(ba(bx),be(by),ba(bz)-1,be(ca)-1,cb)end function nf(bx,by,bz,ca,cb)rectfill(ba(bx),be(by),ba(bz),be(ca),cb)end function ng(nh,ab,bf,cb)print(nh,ba(ab),be(bf),cb)end function jo(ni,nj,nk,nl,...)map(ni,nj,ba(nk),be(nl),...)end function nm(bx,by,bz,ca)clip(ba(bx),be(by),(bz-bx)*8,(bz-bx)*8)end function nn(ab,bf,cg,cb)circfill(ba(ab),be(bf),cg*8,cb)end function no(ab,bf,cg,cb)circ(ba(ab),be(bf),cg*8,cb)end function np(ax)cp.nq(ax.ab,ax.bf,ax.dn,ax.dq)end cp.bt=function(ab,bf)return ct([[cr="bt",cx={nr=true,ab=@1,bf=@2,ee=.375,ef=.375,bh=-2,fl={120,121},fo=1,fv=true,df=@9},cv={"di","dh","fb","dx","cb","gn","ff","ev","fk","et"},ai={{eq=@7,s=@4,fw=ad,ao=ad,an=1.5},{eq=@7,s=@8,fw=ad,ao=@5,an=.5},{eq=@7,s=@6,fw=@3,ao=ad,an=1}}]],ab,bf,function(ax,ns,...)if ns.ga then ns.fi(ns,10)ns.fc(ns,30)end if ns.ev then ns.ew(ns,.3,...)end if not ns.ft then ap(ax,1)end end,function(ax)ax.ea,ax.eb=0,0 ax.fn=0 end,function(ax)ax.bj=js.ab<ax.ab end,function(ax)nt(ax,js,.06)end,bl,function(ax)ax.fn=1 end,np)end cp.nu=function(ab,bf)return ct([[cr="nu",cx={nr=true,ab=@1,bf=@2,ee=.375,ef=.375,fl={122,123},fo=2,fp=10,df=@4,fv=false},cv={"di","dh","fb","dx","cb","ff","ev","fk","et"},ai={{s=@3,an=1.5}}]],ab,bf,function(ax)ax.ea=.01 end,np)end cp.nv=function(ab,bf)return ct([[cr="nv",cx={nr=true,ab=@1,bf=@2,ee=.375,ef=.375,fl={74},df=@4,fo=1},cv={"di","dh","fb","dx","cb","gn","ff","ev","fk","et"},ai={{s=@3,an=1.5}}]],ab,bf,function(ax)ax.eb=.01 ax.ea=.005 end,np)end cp.nw=function(ab,bf)return ct([[cr="nw",cx={nr=true,ab=@1,bf=@2,ee=.375,ef=.375,fl={91},fo=1,df=@4,fv=false},cv={"di","dh","fb","dx","cb","ff","ev","fk","et"},ai={{s=@3,an=1.5}}]],ab,bf,function(ax)ax.ea=sin(t())/50 ax.bj=sgn(ax.ea)<1 end,np)end cp.nx=function(ab,bf)return ct([[cr="nx",cx={nr=true,ab=@1,bf=@2,ee=.375,ef=.375,fl={46},df=@4,fo=1},cv={"di","dh","fb","dx","cb","gn","ff","ev","fk","et"},ai={{s=@3,an=1.5}}]],ab,bf,function(ax)ax.eb=sgn(rnd(1)-.5)*.01 ax.ea=sgn(rnd(1)-.5)*.01 ax.bj=sgn(ax.ea)<1 end,np)end cp.hq=function(ab,bf,hc,ee,ef,az)return ct([[cr="hq",cx={ab=@1,bf=@2,hc=@3,ny=@4,nz=@5,oa=@6,s=@7,df=@8,az=@9,bh=-4,bb=2,bg=2},cv={"dh","et"}]],ab,bf,hc,ee,ef,function(ax,ns)if ns.ga then jy(hc,ee,ef,'ao')end end,function(ax)ax.ob=oc(ax.ab-.75,ax.bf,.25,.5)ax.od=oc(ax.ab+.75,ax.bf,.25,.5)ax.oe=oc(ax.ab,ax.bf-5/8,1,.25)ax.fx=of(ax.ab,ax.bf+1/8,.5,5/8,ax.oa)end,function(ax)ax.ob.db,ax.od.db,ax.oe.db,ax.fx.db=false end,az or 98)end cp.hv=function(ab,bf,og)return ct([[cr="hv",cx={az=51,ee=.5,ef=.5,ab=@1,bf=@2,og=@3,s=@4},cv={"dh","et","fs"}]],ab,bf,og,function(ax)ax.fx=of(ax.ab,ax.bf+1,7/8,.5,function(ax,ns)if btnp(4)and oh=="oi"then lv(og)end end)end)end cp.nq=function(ab,bf,dn,dq)return ct([[cr="nq",cx={az=40,ee=.375,ef=.375,ab=@1,bf=@2,dn=@3,dq=@4,fv=false,fw=@5,},cv={"di","dh","gn","et","cb","dx"},ai={{an=5},{s=@6}}]],ab,bf,dn,dq,function(ax,ns)if ns.ga then oj(10)ax.db=false end end,function(ax)ax.db=false end)end function oc(ab,bf,ee,ef)return ct([[cr="ok",cx={ab=@1,bf=@2,ee=@3,ef=@4,fu=true,fv=true},cv={"dh","fs"}]],ab,bf,ee,ef)end function of(ab,bf,ee,ef,oa)return ct([[cr="ol",cx={ab=@1,bf=@2,ee=@3,ef=@4,fy=@5},cv={"dh","fx"}]],ab,bf,ee,ef,oa)end cp.om=function(ab,bf,on)return ct([[cr="om",cx={ab=@1,bf=@2,ee=.375,ef=.375,az=42,bj=@3,fv=false,ea=@4},cv={"dh","dx","cb","et"},ai={{fw=@5,an=3},{s=@6}}]],ab,bf,on,on and-.1 or.1,function(ax,ns)if ns.nr then oo(ns)i("ew",ns,(ax.ak==1)and.3 or.1,ax.bj and-1 or 1,0)i("fc",ns,30)i("fi",ns,1)ax.db=false end end,function(ax)ax.db=false end)end cp.jd=function(ab,bf)return ct([[cr="jd",cx={az=49,ee=.375,ef=.375,ab=@1,bf=@2,fv=true,},cv={"di","dh","gn","et","cb","dx"},]],ab,bf)end cp.hw=function(ab,bf)return ct([[cr="hw",cx={az=108,ee=.5,ef=.5,bh=-2,ab=@1,bf=@2,s=@3,ao=@4},cv={"dh","et","fs"}]],ab,bf,function(ax)local m=function()if btnp(4)and oh=="oi"then lv("|lark:heya lank, i'm yer biggest fan!")end end local op=6/8 of(ax.ab+1,ax.bf,.5,op,m)of(ax.ab-1,ax.bf,.5,op,m)of(ax.ab,ax.bf+1,op,.5,m)of(ax.ab,ax.bf-1,op,.5,m)end,function(ax)ax.bj=ax.ab-js.ab>0 end)end function oq(ax,os,ot)if ax.poke>0 then ax.poke-=1 ax.bc=ax.bj and os or-os else ax.bc=ax.bj and ot or-ot end end function ou()oh="oi" ov=1 ow={}ox=p([[oy={m=@1,az=09,oz="|^sword:hurts bad guys."},pa={m=@2,az=08,oz="|^banjo:play a sick tune!"},pb={m=@3,az=14,oz="|^shield:be safe from enemy attacks."},pc={m=@4,az=12,oz="|^brang:stun baddies. get items."},pd={m=@5,az=11,oz="|^shovel:dig things up. kill the grass."},pe={m=@6,az=13,oz="|^bomb:only 5 power squares to blows things up!"},pf={m=@7,az=15,oz="|^bow:shoots enemies. needs 2 power squares."},pg={m=@8,az=10,oz="|^sqr'force:don't let ivan take it from you!"},oi={az=43,oz="|^interact:talk to people, pick up things, read signs."},ph={az=44,oz="|^letter:dinner is ready for a special someone."},pi={az=45,oz="|^soul:the soul of an angry family member."},nx={az=46,oz="|^chicken:looks delicious."},j={az=47,oz="|^key:i wonder what it opens."},pj={az=43,oz="|^empty:there is no item in this space."}]],pk,pl,pm,pn,po,pp,pq,pr)add(ow,"oi")add(ow,"pf")add(ow,"pd")add(ow,"oy")add(ow,"pa")add(ow,"pb")add(ow,"pc")add(ow,"pe")add(ow,"pg")end ps={5,4,6,2,8,1,3,7,9}pt={6,4,7,2,1,3,8,5,9}function pu(pv)local pw=ps[pv]-1 return pw%3,flr(pw/3)end function px()if not py and btn(5)then mc()lv(ox[ow[ov]].oz)end if py and not btn(5)then mf()oh,ov=ow[ov]or "oi",1 end py=btn(5)if py then if js.km then js.km.pz=false end local ab,bf=pu(ov)if btnp(0)then ab-=1 end if btnp(1)then ab+=1 end if btnp(2)then bf-=1 end if btnp(3)then bf+=1 end ab,bf=max(0,min(ab,2)),max(0,min(bf,2))local qa=pt[bf*3+ab+1]if ov!=qa then mb()if ow[qa]then lv(ox[ow[qa]].oz)else lv(ox.pj.oz)end end ov=qa end end function qb(ab,bf,az,qc)camera(-ab,-bf)local qd,color=kk(0x9a,1),9 if qc then qd,color=kk(0xd6,2),13 end o(rectfill,[[{-7,-7,6,6,1},{-6,-6,5,5,@1},{-5,-5,4,4,@2}]],color,qd)fillp()if qc then for s=1,15 do pal(s,qe[s])end end bm(az,-4,-4,1,1,false,false,1)spr(az,-4,-4)pal()camera()end function qf(ab,bf)local qg,qh=0,0 for pv=1,9 do local km=ow[pv]local qi,qj=pu(pv)local qk,ql=(ab-16+qi*16),(bf-16+qj*16)if pv==ov then qg=qk-4 qh=ql-4 end if km then qb(qk,ql,ox[km].az,pv!=ov)else rectfill(qk-1,ql-1,qk,ql,1)end end local qm=(t()*60%60>40)and 38 or 39 local qn=function(bx,by,...)spr(qm,qg+bx,qh+by,...)end o(qn,"{-5,-5,1,1,false,false},{5,-5,1,1,true,false},{5,5,1,1,true,true},{-5,5,1,1,false,true}")end function pp(ga)return ct([[cr="qo",cx={pz=true,ee=.375,ef=.375,az=13,bj=@1},cv={"dh","cb","dx","et"},ai={{s=@2,ao=@3}}]],ga.bj,function(ax)ax.ab,ax.bf=ga.ab,ga.bf end,function(ax)if btnp(1)then ax.db=false end end)end function pn(ga)return ct([[cr="qp",cx={pz=true,ee=.375,ef=.375,fl={12,68,69,70},fo=4,fp=10,bj=@1,fv=false},cv={"dh","fk","cb","dx","et"},ai={{fw=@2,s=@3,ao=@4,an=.25},{fw=@2,s=@5,ao=@6}}]],ga.bj,function(ax,ns)if ns.nr then if ns.ev then ns.ew(ns,.05,ax.bj and-1 or 1,0)end if ns.fb then ns.fc(ns,60)end if ax.ak==1 then return true end elseif ns.ga then if ax.ak==2 then ax.db=false ga.km=false end end end,function(ax)ax.ab,ax.bf=ga.ab,ga.bf ax.ea=ax.bj and-.07 or.07 end,function(ax)qq(.75)if qr or not ax.pz then end end,function(ax)end,function(ax)qq(.5)nt(ax,ga,.07)end)end function pm(ga)local qs=.625 return ct([[cr="qt",cx={ft=true,pz=true,ee=.25,ef=.5,bh=-1,poke=20,az=14,bj=@1,fv=false},cv={"dh","ei","spr","cb","et"},ai={{fw=@2,s=@3,ao=@4,an=.4},{fw=@2,s=ad,ao=@5}}]],ga.bj,function(ax,ns)if ns.nr then ax.poke=10 qq(.25)if ns.ev then local qu=(ax.ak==1)and.4 or.2 ns.ew(ns,qu,ax.bj and-1 or 1,0)ga.ew(ga,.1,ax.bj and 1 or-1,0)end if ax.ak==1 and ns.fb then ns.fc(ns,60)end end end,function(ax)ax.el=ax.bj and-qs/10 or qs/10 ax.bc=ax.bj and-3 or 3 ax.poke=20 end,function(ax)qq(.75)oq(ax,0,1)if abs(ax.el+ax.ej)<qs then ax.ej+=ax.el else local qv=-qs ax.el,ax.ej=0,ax.bj and qv or qs end end,function(ax)qq(.25)oq(ax,0,1)if not ax.pz then ax.db,ga.km=false end end)end function pl(ga)return ct([[cr="qw",cx={pz=true,ee=.3,ef=.3,az=8,bj=@1,fv=false,s=@2,ao=@3},cv={"dh","ei","spr","cb","et"}]],ga.bj,function(ax)ax.ek=0 end,function(ax)if not ax.pz then ax.db,ga.km=false end end)end function po(ga)return ct([[cr="qx",cx={pz=true,ee=.3,ef=.3,az=11,bj=@1,fv=false,s=@2,ao=@3},cv={"dh","ei","et"}]],not ga.bj,function(ax)ax.ej=ax.bj and 5/8 or-5/8 ax.ek=0 end,function(ax)local w=mget(ax.ab,ax.bf)if w==16 or w==17 or w==18 or w==19 or w==20 then mset(ax.ab,ax.bf,25)end if not ax.pz then ax.db,ga.km=false end end)end function pr(ga)return ct([[cr="qy",cx={pz=true,ee=.3,ef=.3,az=10,bj=@1,df=@2,ao=@3,fv=false},cv={"dh","ei","et"}]],ga.bj,function(ax)local s=flr(rnd(5))+1 jy(hb[s].hc,hb[s].ab,hb[s].bf)end,function(ax)if not ax.pz then ax.db=false end end)end function pk(ga)return ct([[cr="qz",cx={pz=true,ee=.5,ef=.375,ek=0,bh=-2,az=9,poke=0,bj=@1,fv=false},cv={"dh","ei","spr","cb","et"},ai={{fw=@2,s=@3,ao=@4,an=.4},{fw=@2,s=ad,ao=@5}}]],ga.bj,function(ax,ns)if ns.nr then ax.poke=10 qq(.5)oo(ns)if ns.ev then ns.ew(ns,(ax.ak==1)and.3 or.1,ax.bj and-1 or 1,0)ga.ew(ga,.3,ax.bj and 1 or-1,0)end i("fc",ns,30)i("fi",ns,55)end end,function(ax)ax.el=ax.bj and-.125 or.125 ax.bc=ax.bj and-1 or 1 ax.poke=20 end,function(ax)qq(.75)oq(ax,-1,0)if abs(ax.el+ax.ej)<1 then ax.ej+=ax.el else local qv=-1 ax.el,ax.ej=0,ax.bj and qv or 1 end end,function(ax)qq(.25)oq(ax,-1,0)if not ax.pz then ax.db,ga.km=false end end)end function pq(ga)return ct([[cr="ra",cx={pz=true,ee=.5,ef=.375,ek=0,bh=-1,az=15,bj=@1,df=@5,fv=false},cv={"dh","ei","et"},ai={{s=@2,ao=@3,an=.4},{s=ad,ao=@4}}]],ga.bj,function(ax)ax.el=ax.bj and-.125 or.125 ax.bc=ax.bj and-1 or 1 ax.poke=20 end,function(ax)qq(.75)oq(ax,-1,0)local qs=3/8 if abs(ax.el+ax.ej)<qs then ax.ej+=ax.el else local qv=-qs ax.el,ax.ej=0,ax.bj and qv or qs end end,function(ax)qq(.25)oq(ax,-1,0)if not ax.pz then ax.db,ga.km=false end end,function(ax)if rb(1)then cp.om(ax.ab,ax.bf,ax.bj)end end)end function nt(rc,eo,gl)rd(rc,gl,eo.ab,eo.bf)end function rd(ax,gl,ab,bf)local re=atan2(ab-ax.ab,bf-ax.bf)ax.ea,ax.eb=gl*cos(re),gl*sin(re)end function rf(ax,gk)return rg("ab",ax,gk)and rg("bf",ax,gk)end function rg(gi,ax,gk)local rh,ri,rj,rk=ax[gi],gk[gi],ax["cg"..gi],gk["cg"..gi]return rh>ri-rk-rj and rh<ri+rk+rj end function rl(ax,gk)return ax.ab<gk.ab+gk.ee and ax.ab>gk.ab-gk.ee and ax.bf<gk.bf+gk.ef and ax.bf>gk.bf-gk.ef end function rm()return ct([[cr="rn",cx={az=59,bh=-2,ao=@1},cv={"ei","et"}]],function(ax)ax.bj=js.bj ax.db=js.db end)end function ro(ab,bf)rm()return ct([[cr="ga",cx={ab=@1,bf=@2,fl={56,57,58,59},ee=.375,ef=.375,gb=.25,gc=.25,bh=-2,gl=.02,fo=3,fp=5,fh=50,fg=50,ao=@4,eq=@5,fw=@3,df=@6},cv={"fk","cb","dx","gn","ff","ev","fb","et"}]],ab,bf,function(self,ns,ey,ez)end,function(ax)if ax.dc==0 then if not btn(5)and not(btn(0)and btn(1))then if btn(0)then if not ax.km then ax.bj=true end ax.ea=-ax.gl elseif btn(1)then if not ax.km then ax.bj=false end ax.ea=ax.gl else ax.ea=0 end else ax.ea=0 end if not btn(5)and not(btn(2)and btn(3))then if btn(2)then ax.eb=-ax.gl elseif btn(3)then ax.eb=ax.gl else ax.eb=0 end else ax.eb=0 end end if btn(4)and not btn(5)and not ax.km and not qr then if oh!="pe"or rb(5)then ax.km=rp(ax,oh)else end end local km=ax.km if km then if not km.db then ax.km=nil end if qr or(not btn(4)or btn(5))then km.pz=false end if km.cr=="qw"then ax.ea=0 ax.eb=0 else ax.ea/=2 ax.eb/=2 end end ax.fq=nil if flr((abs(ax.dn)+abs(ax.dq))*50)>0 then ax.fo=3 else ax.fo=1 end if ax.dc!=0 then if ax.km then ax.km.bd=ax.bd end end end,bl,function(ax)if ax.km then ax.km.db=false end end)end function rp(ga,rq)return ox[rq]and ox[rq].m and ox[rq].m(ga)end kr,kq,qr=100,100,false lb,rr=nil,0 rs=0 function oj(rt)rs=min(rs+rt,999)end function rb(rt)if rs-rt>=0 then rs-=rt return true end end function la()local ru="00"..rs return sub(ru,#ru-2,#ru)end function rv(rt)kq=min(kr,kq+rt)if qr and kq>=100 then qr=false end end function qq(rt)if kq-rt>=0 then kq=kq-rt else qr=true end end function oo(rw)lb=rw gv("rx",60*3,function()lb=nil end)end ry=false function _init()poke(0x5f34,1)qe=p("5,5,13,13,5,6,6,6,6,6,6,6,13,6,6")rz=p("1,2,3,4,5,6,7,8,9,10,11,12,13,14,15")av=rz sa=at([[{s=@1,ao=@2,eq=@3}]],sb,sc,sd)ou()end function _update60()if btnp(5)then ry=not ry end ah(sa)lo()end function _draw()cls()i("eq",sa)ma(20,107)if ry then ck(stat(1),104,102)end end function sc()kj()px()kb()if not lq and not jx then o(cy,[[{"ep","er"},{"fb","fd"},{"da","dd"},{"dx","ec"},{"cb","gd",@1},{"cb","gd",@4},{"fx","fz",@3},{"gn","gp",@2},{"ei","en",@3},{"dv","dw"},{"di","dj"},{"da","de"},{"fk","fr"},{"ds","dt"}]],co["cb"],function(ab,bf)return ab>=ke and ab<ke+kf and bf>=kc and bf<kc+kd and fget(mget(ab,bf),1)end,js,co["fs"])rv(.25)ha()else if js.km then js.km.db=false end js.km=nil end mx(js.ab,js.bf)se()end sf=0 sg=0 sh=0 function se()if sh>0 then sf=c()/8 sg=c()/8 sh-=1 else sf,sg=0,0 end end function fa(aj)sh=aj end function sd()jl(jv+8+sf,jw+7+3/8+sg)if py then qf(64,59)end if ry then cy("ed","eg")end kz()end function si()sj=flr(rnd(0x1f00))+0x6040 sk=sj+flr(rnd(0x4)-0x2)fe=flr(rnd(0x40))memcpy(sj,sk,fe)end function sb()hi()js=ro(0,0)jq("ho",21,29)lv("|lank:12341234561 1901234567890 234123456 8901234567890hh ")end