function oc(sk)return sk==0 and 0 or sgn(sk)end function hv()return flr(rnd(3))-1 end function hw(pb,wv)for os,aq in pairs(wv or{})do pb[os]=aq end end function id(ca,na,...)if na and na[ca]then return na[ca](na,...)end end function cw(ad,na)foreach(na,function(t)ad(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])end)end function ou(ad,...)cw(ad,ol(...))end function ma(iv,s,sd)local hh,ae,rt,nj,re,da={},"",1,true while s<=#iv do local o=sub(iv,s,s)if o=="\""then da,nj=not da elseif o=="|" then elseif da then ae=ae..o elseif o=="}"or o==","then if type(ae)=="na"or not nj then elseif sub(ae,1,1)=="@"then local rj=tonum(sub(ae,2,#ae))assert(rj!=nil)if not sd[rj]then sd[rj]={}end add(sd[rj],{hh,re or rt})elseif ae=="ab"then ae=function()end elseif ae=="true"or ae=="false"then ae=ae=="true" elseif ae=="nil"or ae==""then ae=nil elseif nj then ae=tonum(ae)end hh[re or rt],nj,ae,rt,re=ae,true,"",re and rt or rt+1 if o=="}"then return hh,s end elseif o=="{"then ae,s,nj=ma(iv,s+1,sd)elseif o=="="then nj,re,ae=true,ae,"" elseif o!=" "and o!="\n"then ae=ae..o end s+=1 end return hh,s,sd end ll={}function ol(iv,...)if not ll[iv]then ll[iv]={ma(iv..",",1,{})}end local rv,hu={...},ll[iv]for os,aq in pairs(hu[3])do foreach(hu[3][os],function(o)o[1][o[2]]=rv[os]end)end return hu[1]end function ci(k,...)if k.ot==0 then k.oi=k.lq k.lq=(k.oi%#k.np)+1 k.ot=k.np[k.oi]and k.np[k.oi].ag or nil hw(k,k.np[k.oi])id("s",k,...)end if id("v",k,...)then k.ot=0 end if k.ot then k.ot=max(0,k.ot-1/60)end end function mt(k,sk)k.ot=0 if sk then k.lq=sk end end function du(k,np)hw(k,ol([[bh=true,np=@1,bf=0,oi=0,lq=1,ot=0]],np or{}))return k end function uf(...)return du({},ol(...))end function by()for s=1,15 do pal(s,yt[s])end end function cb(a,gb)(gb or spr)(a.p,ob(a.o-a.ok*.5)+a.ij+a.nm,it(a.i-a.oh*.5)+a.og+a.rr,a.ok,a.oh,a.c,a.io,1)end function lv(a)cb(a,nu)end rd={}function pk(p,ok,oh)local hg=oh*8-1 local vl,ue={},function(o,i)return mid(0,o,hg)==o and sget(o+p*8%128,i+flr(p/16)*8)!=0 end local lt=function(o)local oe,ov for s=0,hg do oe,ov=oe or ue(o,s)and s-1,ov or ue(o,hg-s)and oh*8-s end return{oe=oe or oh*8+2,ov=ov or 0}end rd[p]={}for s=0xffff,ok*8 do local ct,d,n=lt(s-1),lt(s),lt(s+1)local oe,ov=min(min(ct.oe,d.oe),n.oe),max(max(ct.ov,d.ov),n.ov)if ov>=oe then add(rd[p],{of=s,im=oe,od=s,nv=ov})end end end function nu(p,o,i,ok,oh,c,io,z)if not ok then ok=1 end if not oh then oh=1 end local lo,lb,ld,hf=o,1,i,1 if c then lo,lb=ok*8-1+o,0xffff end if io then ld,hf=oh*8-1+i,0xffff end if not rd[p]then pk(p,ok,oh)end foreach(rd[p],function(an)rectfill(lo+lb*an.of,ld+hf*an.im,lo+lb*an.od,ld+hf*an.nv,z)end)end function co(ig,o,gw)return o-(gw and(#ig*4+1)or 0)end function sa(ig,o,i,gv)print(ig,o,i+(gv and 1 or-1),1)print(ig,o,i,7)end mz=ol([[{0,0,0,0,0,0,0},{1,1,1,0,0,0,0},{2,2,2,1,0,0,0},{3,3,3,1,0,0,0},{4,2,2,2,1,0,0},{5,5,1,1,1,0,0},{6,13,13,5,5,1,0},{6,6,13,13,5,1,0},{8,8,2,2,2,0,0},{9,4,4,4,5,0,0},{10,9,4,4,5,5,0},{11,3,3,3,3,0,0},{12,12,3,1,1,1,0},{13,5,5,1,1,1,0},{14,13,4,2,2,1,0},{15,13,13,5,5,1,0}]])function ln(s)for d=0,15 do if flr(s+1)>=8 then pal(d,0)else pal(d,mz[d+1][flr(s+1)])end end end ox,av={},{}function au(...)local rv=ol(...)av[rv.r]=function(a)return db(rv,a or{})end end function al(...)return db(ol(...))end function db(ru,a)foreach(ru.y,function(fw)a=av[fw](a)end)hw(a,ru.w)local r=ru.r if not a[r]then ox[r]=ox[r]or{}add(ox[r],a)end a.r,a[r]=r,true du(a,ru.k)return a end function ra(r,ad,...)for a in all(ox[r])do if a[ad]then a[ad](a,...)end end end function pz(a)for os,aq in pairs(ox)do if a[os]then del(aq,a)end end end au([[r="ir",w={ai=true,nl=0,s=ab,v=ab,wm=@1,wl=@2,ia=ab,mu=@3}]],function(a)if a.ai and a.nl==0 then ci(a)end end,function(a)if not a.ai then a:ia()a:mu()end end,function(a)pz(a)end)au([[r="az",w={},y={"ir"}]])au([[r="nt",w={yp=@1},y={"ir"}]],function(a)local x=su[ry]if a.o+a.aa<x.o+.5 then a.o=x.o+.5 a.aa=0 end if a.o+a.aa>x.o+x.l-.5 then a.o=x.o+x.l-.5 a.aa=0 end if a.i+a.at<x.i+.5 then a.i=x.i+.5 a.at=0 end if a.i+a.at>x.i+x.f-.5 then a.i=x.i+x.f-.5 a.at=0 end end)au([[r="cv",w={t=0,ag=0,wk=@1},y={"ir"}]],function(a)a.t+=1 end)au([[r="oq",w={o=0,i=0},y={"ir"}]])au([[r="nd",w={aa=0,at=0,yx=@1},y={"oq"}]],function(a)a.o+=a.aa a.i+=a.at end)au([[r="oa",w={mq=.85,fi=.85,as=0,af=0,wt=@1},y={"nd"}]],function(a)a.aa+=a.as a.at+=a.af a.aa*=a.mq a.at*=a.fi if a.as==0 and abs(a.aa)<.01 then a.aa=0 end if a.af==0 and abs(a.at)<.01 then a.at=0 end end)au([[r="sr",w={m=.375,u=.375,fp=@1},y={"oq"}]],function(a)mb(a.o-a.m,a.i-a.u,a.o+a.m,a.i+a.u,8)end)au([[r="ne",w={om=0,ri=0,on=0,fn=0,yu=@1},y={"ir"}]],function(a,is)a.o,a.i,a.aa,a.at=is.o+a.om,is.i+a.ri,is.aa+a.on,is.at+a.fn a.nm,a.rr=is.nm,is.rr end)au([[r="rq",w={ij=0,og=0,nm=0,rr=0,b=ab,gk=@1},y={"ir"}]],function(a)a.nm,a.rr=0,0 end)au([[r="spr",w={p=0,ok=1,oh=1,c=false,io=false,fa=@1},y={"nd","rq"}]],cb)au([[r="ay",w={wp=@1},y={"spr"}]],lv)au([[r="ic",w={sv=@1},y={"oa"}]],function(a,cy,ds,dl)pl(15)if ds!=0 then a.aa=ds*cy else a.at=dl*cy end end)au([[r="ip",w={rg=@1,pi=@2},y={"oa","rq"}]],function(a,hc)if a.nl==0 then a.nl=hc end end,function(a)if a.nl!=0 then a.af,a.as=0,0 a.nm=hv()a.nl-=1 end end)au([[r="nk",w={oo=33,se=33,lu=@1},y={"ir"}]],function(a,ye)a.oo=min(a.se,a.oo-ye)if a.oo<=0 then a.ai=false end end)au([[r="ib",w={ik={},pa=1,sm=0,oj=1,rk=0,lf=nil,ym=@1},y={"spr","cv"}]],function(a)if a.lf then a.p=a.lf else if a.t%a.rk==0 then a.sm+=1 a.sm%=a.oj end a.p=a.ik[a.pa+a.sm]or 0xffff end end)au([[r="hd",w={dj=true,sj=true,aw=true,ax=ab},y={"nd","sr"}]])au([[r="sb",w={un=ab,gi=@1},y={"nd","sr"}]],function(a,g)if g.o-g.m>a.o-a.m and g.o+g.m<a.o+a.m and g.i-g.u>a.i-a.u and g.i+g.u<a.i+a.u then a.un(a,g)end end)au([[r="h",w={},y={"az","ay"}]])au([[r="z",w={sj=false,aw=true,mc=0,dy=0,ax=ab,sx=@1},y={"nd","sr"}]],function(a,fr)local hi={}local sx=function(aa,at)local dd=false local ph=function(iz,hm,a,q,oq,ap)if ap!=0 and oq<abs(a[iz]-q[iz])then if a.aw and q.aw then aq=a[hm]+q[hm]local mo=function(d)if not d.sj then d[hm]=aq/2 end end mo(a)mo(q)dd=true end hi[q][iz]=ap>0 and 1 or 0+ap<0 and 0xffff or 0 end end foreach(fr,function(q)if a!=q and(not a.sj or not q.sj)then local o,i=abs(a.o+aa-q.o),abs(a.i+at-q.i)if o<(a.m+q.m)and i<(a.u+q.u)then if not hi[q]then hi[q]={o=0,i=0}end ou(ph,[[{"o","aa",@1,@2,@3,@4},{"i","at",@1,@2,@5,@6}]],a,q,o,aa,i,at)end end end)if dd then aa*=-a.mc at*=-a.dy end return aa+at end a.aa=sx(a.aa,0)a.at=sx(0,a.at)for q,b in pairs(hi)do a:ax(q,b.o,b.i)q:ax(a,-b.o,-b.i)end end)au([[r="nf",w={"ut"=ab,"yb"=@1},y={"nd","sr"}]],function(a,ro)a.o,a.aa=cx(a.o,a.i,a.aa,a.m,a.u,0,a,a.ut,ro)a.i,a.at=cx(a.i,a.o,a.at,a.u,a.m,2,a,a.ut,function(i,o)return ro(o,i)end)end)FPS=60 function rs(ww)return flr(t()*FPS)%(ww or 0)end de={}function fh(aj,gq,ya)de[aj]={pw=rs()+gq,ad=ya}end function ff()for os,aq in pairs(de)do if aq.pw-rs()<=0 then id("ad",aq)del(de,aq)end end end hk=ol([[{o=02,i=12,ih="dr"},{o=52,i=60,ih="rw"},{o=69,i=17,ih="lj"},{o=123,i=14,ih="hz"},{o=123,i=60,ih="hp"}]])function mw()su=ol([["po"={n="po",d=03,t=10,o=000,i=00,l=128,f=64},"bi"={n="mp",d=03,t=10,o=000,i=16,l=64,f=16,ao={"rb",063,36}},"iy"={n="mp",d=03,t=17,o=000,i=16,l=32,f=16,ao={"rb",063,38},an={"ch",033,29},{"am",16,18.5,"uv",28,15},{"am",20,24.5,"fm",12,15},{"am",12,24.5,"wz",12,07},{"am",06,22.5,"dr",04,15},{"am",26,22.5,"yc",20,15},{"nn",14.5,19.5,"|sign:mayor lank's home"},{"nn",18.5,24.5,"|sign:bob and bobett's home"},{"nn",13.5,24.5,"|sign:hiroll shop"},{"nn",04.5,22.5,"|sign:ole banjo's house"},{"nn",27.5,22.5,"|sign:hiroll tutorial"},{"lk",14,28},{"oe",15,29}},"ch"={n="mp",d=03,t=17,o=032,i=16,l=32,f=16,ao={"iy",031,29},an={"cd",033,02}},"rb"={n="nz",d=03,t=10,o=048,i=32,l=16,f=08,an={"iy",001,29},ao={"dx",063,44},v={"iw",040,62},b={"iw",040,54},{"am",60,34.5,"uy",28,15},{"nn",58.5,34.5,"|sign:lark's house"}},"dx"={n="nz",d=03,t=10,o=048,i=40,l=16,f=08,an={"rb",049,36},ao={"iw",046,58},v={"iw",040,62},b={"um",060,49}},"um"={n="nz",d=03,t=10,o=048,i=48,l=16,f=08,an={"iw",034,58},ao={"rw",063,60},v={"dx",060,47},b={"iw",040,54}},"rw"={n="nz",d=03,t=10,o=048,i=56,l=16,f=08,an={"um",049,52},ao={"iw",046,58},v={"dz",040,51},b={"iw",040,54},{"am",56,58.5,"fs",20,07},{"oe",56,60}},"dz"={n="nz",d=03,t=10,o=032,i=40,l=16,f=12,v={"wx",040,39},b={"rw",052,57}},"wx"={n="nz",d=03,t=10,o=032,i=32,l=16,f=08,b={"dz",040,41}},"iw"={n="nz",d=03,t=10,o=032,i=52,l=16,f=12},"cd"={n="cm",d=13,t=10,o=032,i=00,l=16,f=08,ao={"ch",063,29},an={"hr",097,29}},"hr"={n="cm",d=13,t=10,o=096,i=00,l=16,f=32,ao={"cd",047,06},an={"cg",033,12},{"am",100,27.5,"wb",04,07}},"cg"={n="cm",d=13,t=10,o=032,i=08,l=16,f=08,ao={"hr",111,29},an={"mm",049,12}},"mm"={n="ug",d=04,t=10,o=048,i=00,l=16,f=16,ao={"cg",047,12},an={"ck",085,30}},"ck"={n="ug",d=04,t=10,o=084,i=12,l=12,f=20,ao={"mm",063,04},v={"uz",088,11}},"uz"={n="ug",d=04,t=10,o=080,i=00,l=16,f=12,b={"ck",090,13},{"am",088,01.5,"ms",69,31,102}},"yo"={n="mh",d=13,t=10,o=112,i=24,l=16,f=08,b={"hr",104,04},v={"hz",120,23}},"hz"={n="mh",d=13,t=10,o=112,i=12,l=16,f=12,b={"yo",120,25},v={"yh",120,11}},"yh"={n="mh",d=13,t=10,o=112,i=00,l=16,f=12,b={"hz",120,13}},"ms"={n="hq",d=13,t=10,o=064,i=22,l=10,f=10,b={"uz",088,02},an={"cc",075,27}},"cc"={n="hq",d=13,t=10,o=074,i=22,l=10,f=10,ao={"ms",073,27},v={"lj",079,21}},"lj"={n="hq",d=13,t=10,o=064,i=12,l=20,f=10,b={"cc",079,23},v={"ys",072,11}},"ys"={n="hq",d=13,t=10,o=064,i=00,l=16,f=12,b={"lj",072,13}},"hp"={n="di",d=13,t=10,o=112,i=56,l=16,f=08,ao={"wr",111,60},v={"dg",120,55}},"wr"={n="di",d=13,t=10,o=096,i=44,l=16,f=20,an={"hp",113,60}},"dg"={n="di",d=13,t=10,o=112,i=44,l=16,f=12,b={"hp",120,57},v={"fo",120,43}},"fo"={n="di",d=13,t=10,o=112,i=32,l=16,f=12,b={"dg",120,45}},"wb"={n="am",d=04,t=10,o=000,i=00,l=08,f=08,b={"hr",100,28}},"wz"={n="am",d=04,t=10,o=008,i=00,l=08,f=08,b={"iy",012,25}},"fs"={n="am",d=03,t=10,o=016,i=00,l=08,f=08,b={"rw",056,59}},"gm"={n="am",d=04,t=10,o=024,i=00,l=08,f=08,b={"uv",028,09}},"gh"={n="am",d=04,t=10,o=024,i=00,l=08,f=08,b={"uy",028,09},{"ns",25.5,1.5},{"ns",25.5,6.5},{"ns",30.5,1.5},{"ns",30.5,6.5}},"dr"={n="am",d=04,t=10,o=000,i=08,l=08,f=08,b={"iy",006,23}},"fm"={n="am",d=04,t=10,o=008,i=08,l=08,f=08,b={"iy",020,25}},"yc"={n="am",d=04,t=10,o=016,i=08,l=08,f=08,b={"iy",026,23}},"uv"={n="am",d=04,t=10,o=024,i=08,l=08,f=08,b={"iy",016,19},v={"gm",028,07}},"uy"={n="am",d=04,t=10,o=024,i=08,l=08,f=08,b={"rb",060,35},v={"gh",028,07},{"ns",26.5,11.5},{"ns",30.5,13.5},{"lk",28,12.5}},"pf"={n="pf",d=03,o=96,i=32,l=11,f=10},"vn"={n="vu",d=13,o=96,i=32,l=16,f=12}]])for os,aq in pairs(su)do aq.s=function()cw(function(px,...)av[px](...)end,aq)end end end uk,uc=0,0 lg=0 function ga(o,i)ln(lg)local x=su[ry]local he=min(16,x.l)local hl=min(12,x.f)local m=o-he/2 local u=i-hl/2 uk=-(16-he)/2+m uc=-(16-hl)/2+u for os,aq in pairs({5,1,1})do rect(m*8+os,u*8+os,(m+he)*8-os-1,(u+hl)*8-os-1,aq)end clip(m*8+4,u*8+4,he*8-8,hl*8-8)rectfill(0,0,127,127,x.d)py(x.o,x.i,x.o,x.i,x.l,x.f)lm(ox["ay"])lm(ox["spr"])lm(ox["rq"])ra("ay","wp")ra("spr","fa")clip()ln(0)end function lm(t)for n=2,#t do local s=n while s>1 and t[s].i<t[s-1].i do t[s],t[s-1]=t[s-1],t[s]s=s-1 end end end function me(li,m,u)reload(0x1000,0x1000,0x2000)ry=li x=su[ry]ra("az","mu")if x.s then x.s()end local o,i,l,f=x.o,x.i,x.l,x.f ar.o=m ar.i=u pe(o,i,l,f,5,11,2,2)fz(ar.o,ar.i)end sw=0 sl=0 sh=false function lz(li,m,u,ac)if not sh then sh=true wf=cocreate(function()for s=0,20 do lg=s/20*10 if ac=='v' then sl=sin(s/80+.5)*10 elseif ac=='b' then sl=sin(s/80)*10 elseif ac=='ao' then sw=sin(s/80+.5)*10 elseif ac=='an' then sw=sin(s/80)*10 end yield()end me(li,m,u)yield()for s=20,0,-1 do lg=s/20*10 if ac=='v' then sl=sin(s/80)*10 elseif ac=='b' then sl=sin(s/80+.5)*10 elseif ac=='ao' then sw=sin(s/80)*10 elseif ac=='an' then sw=sin(s/80+.5)*10 end yield()end sh=false end)end end function gj()local x=su[ry]if sh then coresume(wf)elseif x then local ac=nil if ar.i>ss+dn-.375 then ac='b' elseif ar.i<ss+.5 then ac='v' elseif ar.o>sc+lr-.375 then ac='an' elseif ar.o<sc+.5 then ac='ao' end if ac!=nil and x[ac]then lz(x[ac][1],x[ac][2],x[ac][3],ac)end end end ur=ol([[{op=0x1040.1040,rn=4,ot=15},{op=0x1284.1284,rn=4,ot=30},{op=0x1248.1248,rn=12,ot=10},{op=0x70e0.b0d0,rn=12,ot=1}]])function yl()foreach(ur,function(o)if rs(o.ot)==0 then o.op=rotl(o.op,o.rn)end end)end function rx(z,op)op=ur[op].op return 0x1000+z+op-flr(op)end function my(o,i,a)camera(-o,-i)ou(rectfill,[[{0,0,17,17,5},{1,1,16,16,6},{2,2,15,15,0}]],rx(0x43,4))clip(o+2,i+2,14,14)nu(a.p,5+oc(a.as),5+oc(a.af),1,1,a.c,a.io,1)if a.g then nu(59,5+oc(a.as),5+oc(a.af),1,1,a.c,a.io,1)end if a.h then local h=a.h nu(h.p,5+(h.o-a.o)*8+oc(a.as)+h.ij,7+(h.i-a.i)*8+oc(a.af)+h.og,1,1,h.c,h.io,1)end spr(a.p,5+oc(a.as),5+oc(a.af),1,1,a.c,a.io,1)if a.g then spr(59,5+oc(a.as),5+oc(a.af),1,1,a.c,a.io,1)end if a.h then local h=a.h spr(h.p,5+(h.o-a.o)*8+oc(a.as)+h.ij,7+(h.i-a.i)*8+oc(a.af)+h.og,1,1,h.c,h.io,1)end clip()camera()end function yi(o,i)local lc=103 local wi=flr(max(min(nr/ce*lc,lc-1),1))camera(-o,-i)ou(rect,[[{0,2,@1,3,@2},{1,1,@1,4,0x100d},{@1,0,@1,5,9},{@1,2,@1,3,10},{0,0,@3,5,1}]],wi,rx(0x6c,3),lc)camera()end function gd(o,i,se,oo,flip)oo=oo/se*37+1 local cj,dh=1,oo if flip then oo=39-oo cj,dh=oo,38 end camera(-o,-i)ou(rect,[[{0,0,39,3,1},{@1,1,@2,1,11},{@1,2,@2,2,3},{@3,1,@3,2,9},{@3,1,@3,1,10}]],cj,dh,oo)camera()end function fb(o,i,a,flip)if a and a.ai then local uu=flr(a.oo).."/"..a.se local rf=o+20 local ul=rf if flip then rf,ul=o-17,o-59 end my(flip and(o-17)or o,i,a)gd(ul,i+7,a.se,a.oo,flip)sa(a.aj,co(a.aj,rf,flip),i)sa(uu,co(uu,rf,flip),i+13,true)end end function pd()nu(40,107,2,1,1,false,false,1)spr(40,107,2)sa(wo(),116,4)yi(1,3)ou(fb,[[{1,108,@1},{126,108,@2,true}]],ar,lx)end sn=0 rm=false function pu(bj,o,i)ln(8-sn)if rm then camera(rnd(2)-1,rnd(2)-1)end spr(192,o-16,i-8,4,2)nu(56,o+15,i,1,1,false,false,1)camera()end bu=uf([[{b=@2,ag=.5},{v=@1,b=@2,ag=.5},{v=@4,b=@2,ag=.5},{v=@3,b=@2}]],function()rm=true sn=min(8,sn+8/30)end,pu,function()rm=true sn=max(0,sn-8/30)end,function()rm=false end)sfx(9)ii,oy,wg={},0,25 function fv(ig,fl)local ao,l,sg,so="","",ig.." ",{}for s=1,#sg do local d=sub(sg,s,s)if #l>0 and d==" "then if #(ao..l)>fl then add(so,ao)ao="" end ao,l=ao..l.." ","" else l=l..d end end add(so,ao)return so end function fg(bs)if ah then oy+=.5 if oy>#ah.ng+#ah.nq then oy=#ah.ng+#ah.nq end if btnp(4)and oy>.5 and ah.dc then if oy>=#ah.ng+#ah.nq then del(ii,ah)ah,oy=ii[1],0 else oy=#ah.ng+#ah.nq end end end end function si(ig)local nx,r,ny,rc,sg="","","","|",ig.."|" local cn=true for s=1,#sg do local o=sub(sg,s,s)if o=="^"then cn=false elseif o==":"or o=="|" or o=="@"or o=="%"then if rc==":"then local so=fv(nx,wg)for s=1,#so do local ao=so[s]if s%2==1 then add(ii,{ny=ny,r=r,dc=cn,ng=ao,nq=""})r="" else ii[#ii].nq=ao end end elseif rc=="|" then ny,r=nx,"" elseif rc=="@"then r=nx end rc,nx=o,"" else nx=nx..o end end ah=ii[1]end function gu(o,i)camera(-o,-i)if ah then ou(rectfill,[[{0,0,106,19,5},{1,1,105,18,6},{2,2,104,17,0}]])if #ah.ny>0 then local od=#ah.ny*4+6 ou(rectfill,[[{0,-7,@1,0,5},{1,-6,@2,0,6},{2,-5,@3,1,0}]],od,od-1,od-2)sa(ah.ny,4,-3)end ou(sa,[[{@1,4,4,false},{@2,4,11,true}]],sub(ah.ng,1,oy),sub(ah.nq,0,max(oy-#ah.ng,0)))if ah.dc then spr(71,100,rs(40)<20 and 13 or 14)end end camera()end function le()ii,oy,ah={},0,false end function gs()gl,fu=ah,ii le()end function yn()le()ii,ah=fu,gl end function cx(oq,pn,ap,hx,ge,ac,a,ua,ro)local dp=function(oq,cl)return flr(oq-cl),-flr(-(oq+cl))-1 end local cr,cq=dp(oq+ap,hx)local pv,pr=dp(pn,ge)for cz=pv,pr do if ap<0 and ro(cr,cz)then ua(a,ac)return cr+hx+1,0 elseif ap>0 and ro(cq,cz)then ua(a,ac+1)return cq-hx,0 end end return oq,ap end function pe(...)sc,ss,lr,dn,uq,cp,cf,yq=...end function fz(o,i)lp,lh=o-8,i-8 mr(o,i)end function mg(ht,oz,sy,rl)if ht<oz+uq then oz=ht-uq end if ht>oz+cp then oz=ht-cp end if oz<sy then oz=sy end if oz+16>sy+rl then oz=sy+rl-16 end if rl<16 then oz=rl/2-8+sy end return oz end function mr(yf,fj)lp,lh=mg(yf,lp,sc,lr),mg(fj,lh,ss-cf,dn+cf+yq)end function ob(o)return(o+uk)*8-flr(lp*8)end function it(i)return flr(uc*8)+(i*8)-flr(lh*8)end function mb(of,im,od,nv,z)rect(ob(of),it(im),ob(od)-1,it(nv)-1,z)end function yz(of,im,od,nv,z)rectfill(ob(of),it(im),ob(od),it(nv),z)end function vs(mj,o,i,z)print(mj,ob(o),it(i),z)end function py(fd,yd,yg,yy,...)map(fd,yd,ob(yg),it(yy),...)end function bk(of,im,od,nv)clip(ob(of),it(im),(od-of)*8,(od-of)*8)end function bx(o,i,an,z)circfill(ob(o),it(i),an*8,z)end function bv(o,i,an,z)circ(ob(o),it(i),an*8,z)end function sq(a)av.dk(a.o,a.i,a.aa,a.at)end av.oe=function(o,i)return al([[r="oe",w={aj="|topper",nc=true,o=@1,i=@2,m=.375,u=.375,og=-2,ik={120,121},oj=1,aw=true,ia=@9},y={"nt","az","ip","oa","z","nf","nk","ic","ib","ay"},k={{b=@7,s=@4,ax=ab,v=ab,ag=1.5},{b=@7,s=@8,ax=ab,v=@5,ag=.5},{b=@7,s=@6,ax=@3,v=ab,ag=1}}]],o,i,function(a,j,...)if j.g then j.lu(j,10)j.rg(j,30)end if j.ic then j.sv(j,.3,...)end if not j.dj then mt(a,1)end end,function(a)a.as,a.af=0,0 a.sm=0 end,function(a)a.c=ar.o<a.o end,function(a)cs(a,ar,.06)end,lv,function(a)a.sm=1 end,sq)end av.fy=function(o,i)return al([[r="fy",w={nc=true,o=@1,i=@2,m=.375,u=.375,ik={122,123},oj=2,rk=10,ia=@4,aw=false},y={"nt","az","ip","oa","z","nk","ic","ib","ay"},k={{s=@3,ag=1.5}}]],o,i,function(a)a.as=.01 end,sq)end av.yk=function(o,i)return al([[r="yk",w={nc=true,o=@1,i=@2,m=.375,u=.375,ik={74},ia=@4,oj=1},y={"nt","az","ip","oa","z","nf","nk","ic","ib","ay"},k={{s=@3,ag=1.5}}]],o,i,function(a)a.af=.01 a.as=.005 end,sq)end av.ft=function(o,i)return al([[r="ft",w={nc=true,o=@1,i=@2,m=.375,u=.375,ik={91},oj=1,ia=@4,aw=false},y={"nt","az","ip","oa","z","nk","ic","ib","ay"},k={{s=@3,ag=1.5}}]],o,i,function(a)a.as=sin(t())/50 a.c=sgn(a.as)<1 end,sq)end av.gc=function(o,i)return al([[r="gc",w={nc=true,o=@1,i=@2,m=.375,u=.375,ik={46},ia=@4,oj=1},y={"nt","az","ip","oa","z","nf","nk","ic","ib","ay"},k={{s=@3,ag=1.5}}]],o,i,function(a)a.af=sgn(rnd(1)-.5)*.01 a.as=sgn(rnd(1)-.5)*.01 a.c=sgn(a.as)<1 end,sq)end av.am=function(o,i,ih,m,u,p)return al([[r="am",w={o=@1,i=@2,ih=@3,bc=@4,be=@5,la=@6,s=@7,ia=@8,p=@9,og=-4,ok=2,oh=2},y={"az","ay"}]],o,i,ih,m,u,function(a,j)if j.g then lz(ih,m,u,'v')end end,function(a)a.wh=hy(a.o-.75,a.i,.25,.5)a.mk=hy(a.o+.75,a.i,.25,.5)a.pj=hy(a.o,a.i-5/8,1,.25)a.sb=nb(a.o,a.i+1/8,.5,5/8,a.la)end,function(a)a.wh.ai,a.mk.ai,a.pj.ai,a.sb.ai=false end,p or 98)end av.nn=function(o,i,hb)return al([[r="nn",w={p=51,m=.5,u=.5,o=@1,i=@2,hb=@3,s=@4},y={"az","ay","hd"}]],o,i,hb,function(a)a.sb=nb(a.o,a.i+1,7/8,.5,function(a,j)if btnp(4)and ow==G_INTERACT then si(hb)end end)end)end av.dk=function(o,i,aa,at)return al([[r="dk",w={p=40,m=.375,u=.375,o=@1,i=@2,aa=@3,at=@4,aw=false,ax=@5,},y={"nt","az","nf","ay","z","oa"},k={{ag=5},{s=@6}}]],o,i,aa,at,function(a,j)if j.g then gp(10)a.ai=false end end,function(a)a.ai=false end)end function hy(o,i,m,u)return al([[r="vc",w={o=@1,i=@2,m=@3,u=@4,sj=true,aw=true},y={"az","hd"}]],o,i,m,u)end function nb(o,i,m,u,la)return al([[r="vf",w={o=@1,i=@2,m=@3,u=@4,un=@5},y={"az","sb"}]],o,i,m,u,la)end av.cu=function(o,i,uw)return al([[r="cu",w={o=@1,i=@2,m=.375,u=.375,p=42,c=@3,aw=false,as=@4},y={"az","oa","z","ay"},k={{ax=@5,ag=3},{s=@6}}]],o,i,uw,uw and-.1 or.1,function(a,j)if j.nc then us(j)id("sv",j,(a.oi==1)and.3 or.1,a.c and-1 or 1,0)id("rg",j,30)id("lu",j,1)a.ai=false end end,function(a)a.ai=false end)end av.ns=function(o,i)return al([[r="ns",w={p=49,m=.375,u=.375,o=@1,i=@2,aw=true,},y={"nt","az","nf","ay","z","oa"},]],o,i)end av.lk=function(o,i)return al([[r="lk",w={p=108,m=.5,u=.5,og=-2,o=@1,i=@2,s=@3,v=@4},y={"az","ay","hd"}]],o,i,function(a)local ad=function()if btnp(4)and ow==G_INTERACT then si("|lark:heya lank bro, i'm yer biggest fan!")end end local rp=6/8 nb(a.o+1,a.i,.5,rp,ad)nb(a.o-1,a.i,.5,rp,ad)nb(a.o,a.i+1,rp,.5,ad)nb(a.o,a.i-1,rp,.5,ad)end,function(a)a.c=a.o-ar.o>0 end)end G_INTERACT=5 function nw(a,up,mf)if a.poke>0 then a.poke-=1 a.ij=a.c and up or-up else a.ij=a.c and mf or-mf end end function wu()ud=ol([[{aj="bb",iu=true,ad=@1,p=08,ie="|^banjo:play a sick tune!"},{aj="bq",iu=true,ad=@2,p=12,ie="|^brang:stun baddies. get items."},{aj="ve",iu=true,ad=@3,p=11,ie="|^shovel:dig things up. kill the grass."},{aj="bd",iu=true,ad=@4,p=14,ie="|^shield:be safe from enemy attacks."},{aj="vt",iu=true,ad=ab,p=43,ie="|^interact:talk to people, pick up things, read signs."},{aj="ba",iu=true,ad=@5,p=09,ie="|^sword:hurts bad guys."},{aj="fe",iu=true,ad=@6,p=13,ie="|^bomb:only 5 power squares to blows things up!"},{aj="vh",iu=true,ad=@7,p=15,ie="|^bow:shoots enemies. needs 2 power squares."},{aj="vi",iu=true,ad=@8,p=10,ie="|^sqr'force:don't let ivan take it from you!"}]],wn,fx,gy,gz,ws,wq,gg,wc)ow=G_INTERACT end function nh(no)local h=ud[no or ow]return h.iu and h or nil end function fc()local h=nh()if not hs and btn(5)then gs()si(ud[ow].ie)end if hs and not btn(5)then yn()vr=G_INTERACT end hs=btn(5)if hs then if ar.h then ar.h.ak=false end local o,i=(ow-1)%3,flr((ow-1)/3)if btnp(0)then o-=1 end if btnp(1)then o+=1 end if btnp(2)then i-=1 end if btnp(3)then i+=1 end o,i=max(0,min(o,2)),max(0,min(i,2))local hn=i*3+o+1 if ow!=hn then le()if nh(hn)then si(nh(hn).ie)else si("|^nothing:no item selected")end end ow=hn end end function pp(o,i,p,dv)camera(-o,-i)local mn,color=rx(0x9a,1),9 if dv then mn,color=rx(0xd6,2),13 end ou(rectfill,[[{-7,-7,6,6,1},{-6,-6,5,5,@1},{-5,-5,4,4,@2}]],color,mn)fillp()if dv then for s=1,15 do pal(s,fq[s])end end nu(p,-4,-4,1,1,false,false,1)spr(p,-4,-4)pal()camera()end function gr(o,i)local ml,dq=0,0 for no=1,9 do local h=nh(no)local wy,gf=(no-1)%3,flr((no-1)/3)local ho,ha=(o-16+wy*16),(i-16+gf*16)if no==ow then ml=ho-4 dq=ha-4 end if h then pp(ho,ha,h.p,no!=ow)else rectfill(ho-1,ha-1,ho,ha,1)end end local wj=(t()*60%60>40)and 38 or 39 local ps=function(of,im,...)spr(wj,ml+of,dq+im,...)end ou(ps,"{-5,-5,1,1,false,false},{5,-5,1,1,true,false},{5,5,1,1,true,true},{-5,5,1,1,false,true}")end function wq(g)return al([[r="bg",w={ak=true,m=.375,u=.375,p=13,c=@1},y={"h","z","oa"},k={{s=@2,v=@3}}]],g.c,function(a)a.o,a.i=g.o,g.i end,function(a)if btnp(1)then a.ai=false end end)end function fx(g)return al([[r="vp",w={ak=true,m=.375,u=.375,ik={12,68,69,70},oj=4,rk=10,c=@1,aw=false},y={"h","ib","z","oa"},k={{ax=@2,s=@3,v=@4,ag=.25},{ax=@2,s=@5,v=@6}}]],g.c,function(a,j)if j.nc then if j.ic then j.sv(j,.05,a.c and-1 or 1,0)end if j.ip then j.rg(j,60)end if a.oi==1 then mt(a,2)end elseif j.g then if a.oi==2 then a.ai=false g.h=false end end end,function(a)a.o,a.i=g.o,g.i a.as=a.c and-.07 or.07 sz(10)end,function(a)ix()if st or not a.ak then return true end end,function(a)end,function(a)ix()cs(a,g,.07)end)end function wn(g)return al([[r="go",w={ak=true,m=.3,u=.3,p=8,c=@1,aw=false,s=@2,v=@3},y={"h","ne","z"}]],g.c,function(a)a.ri=0 end,function(a)if not a.ak then a.ai,g.h=false end end)end function gy(g)return al([[r="bp",w={ak=true,m=.3,u=.3,p=11,c=@1,aw=false,s=@2,v=@3},y={"h","ne"}]],not g.c,function(a)a.om=a.c and 5/8 or-5/8 a.ri=0 end,function(a)local ae=mget(a.o,a.i)if ae>=16 and ae<=20 then mset(a.o,a.i,25)end if not a.ak then a.ai,g.h=false end end)end function wc(g)return al([[r="vm",w={ak=true,m=.3,u=.3,p=10,c=@1,ia=@2,v=@3,aw=false},y={"h","ne"}]],g.c,function(a)local s=flr(rnd(5))+1 lz(hk[s].ih,hk[s].o,hk[s].i)end,function(a)if not a.ak then a.ai=false end end)end function gg(g)return al([[r="bn",w={ak=true,m=.5,u=.375,ri=0,og=-1,p=15,c=@1,ia=@5,aw=false},y={"h","ne"},k={{s=@2,v=@3,ag=.4},{s=ab,v=@4}}]],g.c,function(a)a.on=a.c and-.125 or.125 a.ij=a.c and-1 or 1 a.poke=20 sz(5)end,function(a)nw(a,-1,0)local il=3/8 if abs(a.on+a.om)<il then a.om+=a.on else local sp=-il a.on,a.om=0,a.c and sp or il end ix()end,function(a)nw(a,-1,0)if not a.ak then a.ai,g.h=false end ix()end,function(a)if uo(1)then av.cu(a.o,a.i,a.c)end end)end function uj(a,ni,pq,gn,wa,yv,poke,pm)if ni.nc then a.poke=poke if a.oi!=1 then sz(pm)end us(ni)if ni.ic then ni.sv(ni,gn,a.c and-1 or 1,0)ar.sv(ar,pq,a.c and 1 or-1,0)end id("rg",ni,wa)id("lu",ni,yv)end end function ws(g)return al([[r="bm",w={ak=true,m=.5,u=.375,ri=0,og=-2,p=9,poke=20,c=@1,aw=false},y={"h","ne","z"},k={{ax=@2,s=@3,v=@4,ag=.4},{ax=@2,s=ab,v=@5}}]],g.c,function(a,j)uj(a,j,.3,(a.oi==1)and.3 or.1,30,(a.oi==1)and 10 or 5,10,10)end,function(a)a.on=a.c and-.125 or.125 a.ij=a.c and-1 or 1 sz(20)end,function(a)nw(a,-1,0)if abs(a.on+a.om)<1 then a.om+=a.on else local sp=-1 a.on,a.om=0,a.c and sp or 1 end ix()end,function(a)nw(a,-1,0)if not a.ak then a.ai,g.h=false end ix()end)end function gz(g)local il=.625 return al([[r="bo",w={dj=true,ak=true,m=.25,u=.5,og=-1,poke=20,p=14,c=@1,poke=20,aw=false},y={"h","ne","z"},k={{ax=@2,s=@3,v=@4,ag=.4},{ax=@2,s=ab,v=@5}}]],g.c,function(a,j)uj(a,j,.1,(a.oi==1)and.4 or.2,a.oi==1 and j.ip and 60 or 0,0,10,5)end,function(a)a.on=a.c and-il/10 or il/10 a.ij=a.c and-3 or 3 sz(10)end,function(a)nw(a,0,1)if abs(a.on+a.om)<il then a.om+=a.on else local sp=-il a.on,a.om=0,a.c and sp or il end ix()end,function(a)nw(a,0,1)if not a.ak then a.ai,g.h=false end ix()end)end function cs(wd,is,ap)we(wd,ap,is.o,is.i)end function we(a,ap,o,i)local mi=atan2(o-a.o,i-a.i)a.as,a.af=ap*cos(mi),ap*sin(mi)end function bw(a,q)return ux("o",a,q)and ux("i",a,q)end function ux(iz,a,q)local df,dw,uh,ui=a[iz],q[iz],a["an"..iz],q["an"..iz]return df>dw-ui-uh and df<dw+ui+uh end function va(a,q)return a.o<q.o+q.m and a.o>q.o-q.m and a.i<q.i+q.u and a.i>q.i-q.u end function yr()return al([[r="bz",w={p=59,og=-2,v=@1},y={"ne","ay"}]],function(a)a.c=ar.c a.ai=ar.ai end)end function mx(o,i)yr()return al([[r="g",w={aj="|lank",o=@1,i=@2,ik={56,57,58,59},m=.375,u=.375,mc=.25,dy=.25,og=-2,ap=.02,oj=3,rk=5,se=50,oo=50,v=@4,b=@5,ax=@3,ia=@6},y={"ib","z","oa","nf","nk","ic","ip","ay"}]],o,i,function(self,j,ds,dl)end,function(a)if a.nl==0 then if not btn(5)and not(btn(0)and btn(1))then if btn(0)then if not a.h then a.c=true end a.as=-a.ap elseif btn(1)then if not a.h then a.c=false end a.as=a.ap else a.as=0 end else a.as=0 end if not btn(5)and not(btn(2)and btn(3))then if btn(2)then a.af=-a.ap elseif btn(3)then a.af=a.ap else a.af=0 end else a.af=0 end end if btn(4)and not btn(5)and not a.h and not st then if nh().aj!="fe"or uo(5)then a.h=yw(a,ow)else end end local h=a.h if h then if not h.ai then a.h=nil end if st or(not btn(4)or btn(5))then h.ak=false end if h.r=="go"then a.as=0 a.af=0 else a.as/=2 a.af/=2 end end a.lf=nil if flr((abs(a.aa)+abs(a.at))*50)>0 then a.oj=3 else a.oj=1 end if a.nl!=0 then if a.h then a.h.nm=a.nm end end end,lv,function(a)if a.h then a.h.ai=false end end)end function yw(g,vd)return nh()and nh().ad(g)end lx,vo=nil,0 sf=0 function gp(iq)sf=min(sf+iq,999)end function uo(iq)if sf-iq>=0 then sf-=iq return true end end function wo()local ly="00"..sf return sub(ly,#ly-2,#ly)end function gt(iq)if st and nr>=100 then st=false end if rh>0 then rh=max(0,rh-1)nr=max(0,nr-1)elseif not dm then nr=min(ce,nr+iq)end if nr==0 then st=true end dm=false end function ix()dm=true end ce,nr,st,rh,br=100,100,false,0,false function sz(iq)rh+=iq end function us(gx)lx=gx fh("bt",60*3,function()lx=nil end)end rz=false function _init()poke(0x5f34,1)fq=ol("5,5,13,13,5,6,6,6,6,6,6,6,13,6,6")fk=ol("1,2,3,4,5,6,7,8,9,10,11,12,13,14,15")yt=fk md=uf([[{s=@1,v=@2,b=@3}]],pc,pg,pt)wu()end function _update60()if btnp(5)and btn(4)then rz=not rz end ci(md)fg()end function _draw()cls()id("b",md)gu(20,107)if rz then sa(stat(1),104,102)end end function pg()yl()fc()gj()if not ah and not sh then ou(ra,[[{"rq","gk"},{"ip","pi"},{"ir","wm"},{"oa","wt"},{"z","sx",@1},{"z","sx",@4},{"sb","gi",@3},{"nf","yb",@2},{"ne","yu",@3},{"nd","yx"},{"nt","yp"},{"ir","wl"},{"ib","ym"},{"cv","wk"}]],ox["z"],function(o,i)return o>=sc and o<sc+lr and i>=ss and i<ss+dn and fget(mget(o,i),1)end,ar,ox["hd"])gt(.25)ff()else if ar.h then ar.h.ai=false end ar.h=nil end mr(ar.o,ar.i)yj()end hj=0 lw=0 dt=0 function yj()if dt>0 then hj=hv()/8 lw=hv()/8 dt-=1 else hj,lw=0,0 end end function pl(ot)dt=ot end function pt()ga(sw+8+hj,sl+7+3/8+lw)if hs then gr(64,59)end if rz then ra("sr","fp")end pd()end function bl()ub=flr(rnd(0x1f00))+0x6040 mv=ub+flr(rnd(0x4)-0x2)hc=flr(rnd(0x40))memcpy(ub,mv,hc)end function pc()mw()ar=mx(0,0)me("iy",21,29)si("|lank:12341234561 1901234567890 234123456 8901234567890hh ")end